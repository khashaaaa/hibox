<section class="block-item-main js-product js-product-<?= $product->id ?>"
         data-action-get-configuration-info="<?= UrlGenerator::toRoute('product/get-configuration-info', ['id' => $product->id]) ?>"
         data-action-get-full-info="<?= UrlGenerator::toRoute('product/get-full-info', ['id' => $product->id]) ?>"
         data-action-reload="<?= UrlGenerator::toRoute('product', ['id' => $product->id, 'reload' => 1]) ?>"
         data-product-id="<?= $product->id ?>"
         data-product-not-available-id="<?= $product->notAvailableId ?>"
         data-product-is-incomplete="<?= $product->isIncomplete() ? 1 : 0 ?>"
         data-product-url="<?= $itemUrl ?>"
         data-is-short="<?= $isAjax ? 1 : 0 ?>"
>
    <div class="center">
        <? // TODO: унести в $_page[title] ?>
        <? if (! General::getConfigValue('hide_item_title')) { ?>
            <h1><?=$this->escape($product->title)?></h1>
        <? } ?>

        <div class="block-item__top">
            <div class="block-item-main__left">
                <div class="gallery-sample-wrap sticky-top">
                    <!-- главный медиа контент для больших экранов -->
                    <div class="product-main-media-wrapper">
                        <?= ProductsHelper::getHtmlFeatureListForLabel((array)$product->features); ?>
                        <div class="js-product-main-video-wrapper"
                             style="display: <?=$product->videos ? 'block' : 'none'?>"
                        >
                            <?
                            $videoSrc = '';
                            if ($product->videos) {
                                foreach ($product->videos as $video) {
                                    $videoSrc = $video->GetUrlAttribute();
                                    break;
                                }
                            }
                            ?>
                            <video src="<?=$videoSrc?>"
                                   class="item_video js-product-main-video"
                                   controls autoplay muted loop
                            ></video>
                        </div>

                        <div class="js-product-main-photo-wrapper product-main-photo-wrapper"
                             style="display: <?=$product->videos ? 'none' : 'block'?>"
                        >
                            <a href="<?=$product->mainPicture['url']?>"
                               class="cloud-zoom js-product-main-photo-link"
                               onclick="return false"
                               rel="smoothMove: 5"
                            >
                                <img alt="img"
                                     src="<?=$product->mainPicture['large']?>"
                                     class="js-product-main-photo js-product-main-photo-<?=$product->id?>"
                                >
                            </a>
                        </div>
                    </div>

                    <!-- слайдер с миниатюрами для больших экранов -->
                    <ul class="recent_list slider slider-product-list js-slider-product-list">
                        <? if ($product->videos) { ?>
                            <? foreach ($product->videos as $video) { ?>
                                <li class="photo_container js-product-media main_video_item">
                                    <a href="javascript:void(0)">
                                        <img itemprop="image" src="<?=$video->GetPreviewUrlAttribute()?>"
                                             class="img-responsive js-product-slide-video"
                                             data-src="<?=$video->GetUrlAttribute()?>"
                                             data-poster="<?=$video->GetPreviewUrlAttribute()?>"
                                             alt="img"
                                        >
                                    </a>

                                    <i class="fa fa-play-circle-o item_video_circle js-product-slide-video"></i>
                                </li>
                            <? } ?>
                        <? } ?>

                        <? foreach ($product->pictures as $picture) { ?>
                            <li class="photo_container js-product-media item_photo">
                                <a href="javascript:void(0)">
                                    <img itemprop="image"
                                         src="<?=$picture['small']?>"
                                         class="img-responsive js-product-slide-photo"
                                         data-src-large="<?=$picture['large']?>"
                                         data-src-url="<?=$picture['url']?>"
                                         alt="img"
                                    >
                                </a>
                            </li>
                        <? } ?>
                    </ul>

                    <!-- большой слайдер с для мобильных экранов -->
                    <div class="slider-product-item js-slider-product">
                        <?= ProductsHelper::getHtmlFeatureListForLabel((array)$product->features); ?>
                        <? if ($product->videos) { ?>
                            <? foreach ($product->videos as $video) { ?>
                                <div class="slide js-product-slide">
                                    <video src="<?=$video->GetUrlAttribute()?>" class="item_video" controls autoplay muted loop></video>
                                </div>
                            <? } ?>
                        <? } ?>

                        <? foreach ($product->pictures as $picture) { ?>
                            <div class="slide js-product-slide">
                                <img src="<?=$picture['large']?>" alt="img">
                            </div>
                        <? } ?>
                    </div>

                    <div class="js-product-slide-skeleton" style="display: none">
                        <div class="slide js-product-slide js-product-slide-config">
                            <img src="" alt="img">
                        </div>
                    </div>
                </div>
            </div>

            <div class="block-item-main__right">
                <div class="block-information-progressbar js-product-reload-start" style="display: none">
                    <div class="progressbar-background"></div>
                    <div class="progressbar-wrapper">
                        <h5><?=Lang::get('product_reload_start')?></h5>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated"
                                 role="progressbar"
                                 aria-valuenow="75"
                                 aria-valuemin="0"
                                 aria-valuemax="100"
                                 style="width: 100%"
                            ></div>
                        </div>
                    </div>
                </div>

                <div class="block-information-progressbar js-product-reload-error" style="display: none">
                    <div class="progressbar-background"></div>
                    <div class="error-wrapper">
                        <h5><?=Lang::get('product_reload_error')?></h5>
                    </div>
                </div>

                <div class="row-block-top">
                    <div class="row-code"><?=Lang::get('good_code').' '.$product->id?></div>
                    <? if(!General::getConfigValue('hide_taobao_link') || OTBase::isAdmin()) { ?>
                        <div class="row-link-right"><a href="<?=$product->externalItemUrl?>" target="_blank"><?=Lang::get('link_to_original')?></a></div>
                    <? } ?>
                </div>

                <div class="row-block js-row-item-price">
                    <div class="row-label config row-label-item-price"><?=Lang::get('price')?>:</div>
                    <div class="row-content-item-price row-col2 config">
                        <div style="width: 100%; display: inline-block">
                            <div class="item-product__price">
                                <div class="item-product__price_new
                                            item-product__price_new_large
                                            js-product-configuration-current-price"
                                >
                                    <i class="fa fa-spinner fa-pulse fa-fw"></i>
                                </div>

                                <div class="price-old__wrap">
                                    <div class="item-product__price_old item-product__price_old_large">
                                        <span class="js-product-configuration-current-old-price"></span>
                                    </div>
                                    <div style="display: none;"
                                         class="item-product__price_discount
                                                item-product__price_discount_large
                                                js-product-configuration-current-discount-percent"
                                    ></div>
                                </div>
                            </div>
                        </div>

                        <? if (!General::getConfigValue('hide_item_info_price_local_delivery')) { ?>
                            <div class="js-product-configuration-internal-delivery" style="display: inline-block">
                                <p class="p-delivery " style="display: none"></p>
                            </div>
                            <a href="javascript:void(0)"
                               class="info-circle js-tooltip internal_delivery_tooltip"
                               data-toggle="tooltip"
                               title="<?=Lang::get('inner_delivery_hint')?>"
                               style="display: none"
                            >?</a>
                        <? } ?>
                    </div>
                </div>

                    <table class="table table-yellow table-borderless table-amount-desktop js-product-configuration-quantity-range">
                        <thead><tr class="js-product-quantity-range-head-piece"></tr></thead>
                        <tbody><tr class="js-product-quantity-range-body-piece"></tr></tbody>
                    </table>

                    <!--  <div class="row-block row-block__mobile-hidden">
                          <div class="row-label config"><?/*=Lang::get('condition')*/?>:</div>
                          <div class="row-col2 config">Новый</div>
                      </div>-->

                    <? if ($product->weight) { ?>
                        <? if (!General::getConfigValue('hide_item_info_weight')) { ?>
                            <div class="row-block row-block-weight">
                                <div class="row-label config"><?=$product->weightLabel?>:</div>
                                <div class="row-col2 config"><?=$product->weight?> <?=Lang::get('weight_kg')?></div>
                            </div>
                        <? } ?>
                    <? } ?>

                    <? if ($product->features) { ?>
                        <div class="row-block">
                            <? foreach ($product->features as $feature) { ?>
                                <? if ($feature->GetDisplayNameAttribute()) { ?>
                                    <? if ($feature->GetDisplayTypeAttribute() !== 'Label') { ?>
                                        <div class="row-label config"><?=$feature->GetDisplayNameAttribute()?>:</div>
                                        <div class="row-col2 config"><?=$feature->asString()?></div>
                                    <? } ?>
                                <? } ?>
                            <? } ?>
                        </div>
                    <? } ?>

                    <? foreach ($product->сonfigurators as $key => $property) { ?>
                        <div class="row-block row-block_grey <?=$key===0?'row-block-first-configurator':''?>">
                            <div class="row-label row-label2 align-middle">
                                <?=$property->GetDisplayNameAttribute()?>:
                            </div>

                            <div class="row-content-item-configurator row-col2">
                                <ul data-property-id="<?=$property->GetIdAttribute()?>"
                                    class="product-property-buttons
                                           js-product-configurator-images
                                           productConfiguratorImages"
                                >
                                    <? foreach ($property->GetValue() as $value) { ?>
                                        <? if ($value->GetPicture()->GetSmall()->asString()) { ?>
                                            <li class="js-product-configurator-image productConfiguratorImage js-product-configurator-image-<?=$product->id?>"
                                                data-property-value-id="<?=$value->GetIdAttribute()?>"
                                                title="<?=$value->GetDisplayNameAttribute()?>"
                                            >
                                                <a href="javascript:void(0)"
                                                   class="config_image js-product-config-image"
                                                   data-img-large="<?=$value->GetPicture()->GetLarge()->asString()?>"
                                                   data-img-url="<?=$value->GetPicture()->GetUrl()?>"
                                                   style="background: url(<?=$value->GetPicture()->GetSmall()->asString()?>) center; background-size: cover;"
                                                ></a>
                                                <div class="cor"></div>
                                            </li>
                                        <? } else { ?>
                                            <li class="js-product-configurator-image productConfiguratorImage productConfiguratorImage_config-text-block"
                                                data-property-value-id="<?=$value->GetIdAttribute()?>"
                                                title="<?=$value->GetDisplayNameAttribute()?>"
                                            >
                                                <span><?=$value->GetDisplayNameAttribute()?></span>
                                            </li>
                                        <? } ?>
                                    <? } ?>
                                </ul>

                                <select class="productConfigurator js-product-configurator" data-property-id="<?=$property->GetIdAttribute()?>" style="display: none;">
                                    <option value=""></option>
                                    <? foreach ($property->GetValue() as $value) { ?>
                                        <option value="<?=$value->GetIdAttribute()?>"><?=$value->GetDisplayNameAttribute()?></option>
                                    <? } ?>
                                </select>
                            </div>
                        </div>
                    <? } ?>

                    <? if ($product->сonfigurators) { ?>
                        <div class="row-block row-block_grey">
                            <div class="row-label"><?=Lang::get('selected_conf')?>:</div>
                            <div class="row-col2">
                                <div class="js-chosen-config"></div>
                            </div>
                        </div>
                    <? } ?>

                    <? if (!$product->сonfiguratorMultiInput) { ?>
                        <div class="row-block row-block_grey row-block-quantity js-row-quantity">
                            <div class="row-label config row-label2 row-label-quantity"><?=Lang::get('quantity')?>:</div>
                            <div class="row-col2 row-col2-2 quantity">
                                <div class="number">
                                    <span class="number__minus js-product-qty-minus">-</span>
                                    <input type="text" value="1" class="productQuantity js-product-quantity" maxlength="10" data-type="integer" />
                                    <span class="number__plus js-product-qty-plus">+</span>
                                </div>
                                <span class="available_quantity js-product-available-quantity"><?=Lang::get('in_existence')?> <i class="fa fa-spinner fa-pulse fa-fw"></i> <?=Lang::get('pcs')?></span>
                            </div>
                        </div>
                    <? } ?>

                    <? if ($product->сonfiguratorMultiInput) { ?>
                        <div class="row-block dropdown-multiinput js-dropdown multiinput">
                            <div class="row-label row-label2">
                                <?=$product->сonfiguratorMultiInput->GetDisplayNameAttribute()?>:
                            </div>
                            <div style="display: table" data-property-id="<?=$product->сonfiguratorMultiInput->GetIdAttribute()?>"
                                  class="table
                                  table-sizes
                                  table-borderless
                                  js-product-multi-input-table
                                  productMultiInputTable">
                            <? foreach ($product->сonfiguratorMultiInput->GetValue() as $key => $value) { ?>
                            <div data-property-value-id="<?=$value->GetIdAttribute()?>"
                                 class=" <?=($key >= 3) ? 'block__table-hidden js-dropdown-hidden-el' : 'block__table-row'?>
                                                   js-product-multi-input-table-body-row
                                                   js-product-property-value-id">
                                <div class="block__table-cell js-product-configurator-image">
                                    <? if ($value->GetPicture()->GetSmall()->asString()) { ?>
                                        <a href="javascript:void(0)"
                                           class="config_image js-product-config-image"
                                           data-img-large="<?=$value->GetPicture()->GetLarge()->asString()?>"
                                           data-img-url="<?=$value->GetPicture()->GetUrl()?>"
                                        >
                                            <img src="<?=$value->GetPicture()->GetSmall()->asString()?>">
                                        </a>
                                    <? } else { ?>
                                        <p class="animate_fade js-animate-fade"><?=$value->GetDisplayNameAttribute()?></p>
                                    <? } ?>
                                </div>
                                <div class="block__table-cell price">
                                    <b class="animate_fade js-animate-fade js-product-multi-input-configurations-price"
                                       data-configuration-info="ConfigurationMultiInputConfigurationsPrice"
                                    ></b>
                                </div>
                                <div class="block__table-cell available-quantity animate_fade js-animate-fade js-product-multi-input-configurations-available-quantity"
                                     data-configuration-info="ConfigurationMultiInputConfigurationsAvailableQuantity">
                                </div>
                                <div class="block__table-cell quantity">
                                    <div class="quantity">
                                        <div class="number">
                                            <span class="number__minus js-product-qty-minus">-</span>
                                            <input type="text" value="0" maxlength="6" min="0"
                                                   class="productMultiInputQuantity js-product-multi-input-quantity form form-control"
                                                   data-type="integer" />
                                            <span class="number__plus js-product-qty-plus">+</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <? } ?>
                            </div>
                            <? if ($key >= 3) { ?>
                                <div class="row-down-arrow js-dropdown-arrow"><span></span></div>
                            <? } ?>
                       </div>
                    <? } ?>

                    <div class="row-block">
                        <div class="row-label config-delivery js-product-config-delivery" style="display: none">
                            <?=Lang::get('delivery_modes')?>:
                        </div>

                        <div class="row-col2 config">
                            <div class="choose-delivery">
                                <div class="choose-delivery__price js-product-choose-delivery-price"></div>
                                <a href="javascript:void(0)" class="choose-delivery__a js-product-choose-delivery">
                                    <span class="choose-delivery__name js-product-choose-delivery-name"></span>
                                    <i class="arrow-down"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="row-block js-product-price-new-row" style="display: none;">
                        <div class="row-label config config-full-price">
                            <?=Lang::get('total_cost')?>:
                        </div>

                        <div class="row-col2 config">
                            <div class="item-product__price_new item-product__price_new_large js-product-price-new">
                                <i class="fa fa-spinner fa-pulse fa-fw"></i>
                            </div>
                            <input type="hidden" id="full_price" value="">
                        </div>
                    </div>

                    <div class="row-block additional-price js-product-additional-price-row">
                        <div class="additional-price_header js-additional-price-header" style="display: none"><b><?=Lang::get('additional_value')?>:</b>
                            <a href="javascript:void(0)"
                               class="info-circle js-tooltip"
                               data-toggle="tooltip"
                               title="<?=Lang::get('supplement_for_heading')?>"
                            >?</a>
                            <div class="row-label config">&nbsp;</div>
                            <div class="row-col2 config js-product-additional-price-config config-additional-price">
                                <p class="value-added"></p>
                            </div>
                        </div>

                        <? if ($product->notAvailableReason) { ?>
                            <h3><?=Lang::get('item_not_allowed')?></h3>
                            <h3><?=Lang::get($product->notAvailableReason)?></h3>
                        <? } else { ?>
                            <div class="js-panel-buttons panel-buttons">
                            <button class="js-product-quick-order-btn button button-red button__quick-order js-tooltip"
                                    data-is-authenticated="<?=(int)User::getObject()->isAuthenticated()?>"
                                    data-authentication-action="<?=UrlGenerator::getUrl('login')?>"
                                    data-item-id="<?=$product->id?>"
                                    data-weight="<?=$product->weight?>"
                                    data-provider="<?=$product->provider?>"
                                    data-toggle="tooltip"
                                    title="<?=Lang::get('choose_config')?>"
                                    data-action="<?=UrlGenerator::getUrl('order/quick-order')?>"
                                    data-loading-text="<?=Lang::get('loading')?>..."
                            >
                                <i></i><?=Lang::get('quick_order')?>
                            </button>

                                <button class="button button__in-garbage js-product-btn-in-garbage js-tooltip"
                                        data-action="<?=UrlGenerator::toRoute('product/add')?>"
                                        data-item-id="<?=$product->id?>"
                                        data-toggle="tooltip"
                                        title="<?=Lang::get('choose_config')?>"
                                        data-target="#modal-add-done-<?=$product->id?>"
                                >
                                    <i></i><?=Lang::get('Add_item_to_cart')?>
                                </button>
                            </div>

                            <div class="panel-add js-panel-add">
                                <a href="javascript:void(0)"
                                   data-placement="top"
                                   data-toggle="tooltip"
                                   data-item-id="<?=$product->id?>"
                                   data-action="<?=UrlGenerator::toRoute('product/addToFavourites')?>"
                                   class="add-favorite js-product-btn-in-favorite desktop-favourite disabled_button js-tooltip"
                                   title="<?=Lang::get('choose_config')?>"
                                >
                                    <i class="fa fa-heart-o"></i>
                                    <?=Lang::get('Add_item_to_fav')?>
                                </a>
                            </div>
                        <? } ?>
                        <? $socialNetworks = InstanceProvider::getObject()->GetSocialNetworks(); ?>
                        <? if ($socialNetworks->GetCommonShareWidget()) { ?>
                            <div class="repost-social">
                                <?=$socialNetworks->GetCommonShareWidget();?>
                            </div>
                        <? } ?>
                    </div>
                </div>

                <div class="hidden js-product-modal-delivery">
                    <table class="table table-delivery table-borderless js-product-table-delivery">
                        <thead>
                            <tr>
                                <th scope="col"><?=Lang::get('transport_company')?></th>
                                <th scope="col"><?=Lang::get('delivery_description')?></th>
                                <th scope="col"><?=Lang::get('delivery_cost')?></th>
                            </tr>
                        </thead>
                        <tbody class="js-product-table-delivery-body"></tbody>
                    </table>
                </div>

                <div class="modal-add-done js-product-modal-add-done hidden" data-make-order-link="<?=UrlGenerator::toRoute('basket')?>">
                    <div class="modal-wrap">
                        <div class="modal-left">
                            <img src="img/item-img-slider1.jpg" class="item-img js-products-modal-add-done-img" alt="img">
                        </div>

                        <div class="modal-right">
                            <div class="row-block">
                                <?=Lang::get('Add_count_item_to_cart')?>:

                                <b class="full_cart_amount js-full_cart_amount">
                                    <?=$this->getUser()->getCountInBasket()?>
                                </b>

                                <a href="<?=UrlGenerator::toRoute('basket')?>" class="link-show"><?=Lang::get('review_1')?></a>
                            </div>

                            <div class="item-product__price">
                                <div class="item-product__price_new item-product__price_new_large">
                                    <div style="display: inline-block"><?=Lang::get('total_amount')?>:</div> <div class="total-cost js-product-total-cost" style="display: inline-block"></div>
                                </div>

                                <div class="row-block row-amount">
                                    <?=Lang::get('quantity')?>: <div class="total-amount js-product-total-amount" style="display: inline-block"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        <div class="block-item__bottom">
            <div class="aside-seller">
                <div class="panel yellow2-panel"><?=Lang::get('about_vendor')?></div>

                <div class="table-seller"
                     data-full-info-block="Vendor"
                     data-full-info-need-request="<?= $blocks['Vendor']['needRequest'] ? 1 : 0 ?>"
                >
                    <? if (!$blocks['Vendor']['needRequest']) { ?>
                        <?=$blocks['Vendor']['html']?>
                    <? } else { ?>
                        <i class="fa fa-spinner fa-pulse fa-fw"></i>
                    <? } ?>
                </div>

                <a href="javascript:void(0)"
                   class="add-seller-favorites js-product-add-vendor-to-favorites"
                   data-vendor-id="<?=$product->vendorId?>"
                   data-action="<?=UrlGenerator::toRoute('product/addVendorToFavourites')?>"
                >
                    <i class="fa fa-heart-o"></i>
                    <?=Lang::get('add_vendor_to_favourites')?>
                </a>

                <div data-full-info-block="MostPopularVendorItems16"
                     data-full-info-need-request="<?= $blocks['MostPopularVendorItems16']['needRequest'] ? 1 : 0 ?>"
                >
                    <? if (!$blocks['MostPopularVendorItems16']['needRequest']) { ?>
                        <?=$blocks['MostPopularVendorItems16']['html']?>
                    <? } else { ?>
                        <i class="fa fa-spinner fa-pulse fa-fw"></i>
                    <? } ?>
                </div>
            </div>

            <nav class="navbar">
                <ul class="nav nav-tabs w-100" id="myTab" role="tablist">
                    <li class="nav-item js-nav-item">
                        <a id="home-tab"
                            role="tab"
                            href="#home"
                            data-toggle="tab"
                            aria-controls="home"
                            aria-selected="true"
                            class="nav-link active"
                        ><?=Lang::get('Description')?><span><?=Lang::get('review_1')?></span></a>
                    </li>
                    <li class="nav-item js-nav-item">
                        <a id="properties-tab"
                           role="tab"
                           href="#properties"
                           data-toggle="tab"
                           aria-controls="properties"
                           aria-selected="true"
                           class="nav-link"
                        ><?=Lang::get('Product_properties')?><span><?=Lang::get('review_1')?></span></a>                      
                    </li>
                    <li class="nav-item js-nav-item">
                        <a role="tab"
                           href="#reviews"
                           id="reviews-tab"
                           data-toggle="tab"
                           aria-selected="false"
                           aria-controls="profile"
                           class="nav-link js-reviews-tab"
                           data-provider="<?=$product->provider?>"
                           data-item-id="<?=$product->id?>"
                           data-action="<?=UrlGenerator::toRoute('product/reviews');?>"
                        ><?=Lang::get('item_reviews')?><span><?=Lang::get('review_1')?></span></a>
                    </li>
                    <!--  <li class="nav-item">
                          <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Сторонние отзывы <span>Смотреть</span></a>
                      </li>-->
                </ul>

                <div class="tab-content" id="myTabContent" style="width: 100%">
                    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                        <div class="table-descriptions">
                            <div class="product-descriptions"
                                 data-full-info-block="Description"
                                 data-full-info-need-request="<?= $blocks['Description']['needRequest'] ? 1 : 0 ?>"
                            >
                                <?= !$blocks['Description']['needRequest'] ? $blocks['Description']['html'] : '<i class="fa fa-spinner fa-pulse fa-fw"></i>' ?>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade show" id="properties" role="tabpanel" aria-labelledby="properties-tab">
                        <div class="table-descriptions">
                            <? if ($product->properties) { ?>
                                <? foreach ($product->properties as $key => $property) { ?>
                                    <div class="table-descriptions__row product-property-<?=is_numeric($key)?$key:md5($key)?>">
                                        <div class="table-descriptions__col_left"><?=$property['DisplayName']?>:</div>
                                        <div class="table-descriptions__col_right">
                                            <?= implode('; ', $property['Values']) ?>
                                        </div>
                                    </div>
                                <? } ?>
                            <? } else { ?>
                                <?= Lang::get('Product_has_no_properties') ?>
                            <? } ?>
                        </div>
                    </div>
                    <div class="tab-pane fade js-tab-reviews" id="reviews" role="tabpanel" data-type="Internal" data-item-id="<?=$product->id?>"
                         aria-labelledby="reviews-tab">
                        <? AssetsMin::registerJsFile('js/pages/itemreviews.js') ?>
                        <div class="col-lg-12 js-reviews-container" style="width: 100%">
                            <div class="spinner"></div>
                        </div>
                    </div>
                    <!-- <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                         <div class="col-lg-12">
                             TODO:
                         </div>
                     </div>-->
                </div>
            </nav>

            <? AssetsMin::registerCssFile('css/vendor/jquery.raty.css') ?>
            <? AssetsMin::registerJsFile('js/vendor/jquery.raty.js') ?>
        </div>

        <div class="sticky-top-mobile-wrap sticky-top-mobile-wrap2">
            <div class="buttons-sticky-mobile sticky-top-mobile">
                <div class="panel-buttons js-panel-buttons">
                    <a href="javascript:void(0)"
                       data-action="<?=UrlGenerator::toRoute('product/addToFavourites')?>"
                       data-item-id="<?=$product->id?>"
                       data-toggle="tooltip"
                       title="<?=Lang::get('choose_config')?>"
                       class="add-favorite js-product-btn-in-favorite js-tooltip"
                    ><i></i></a>

                    <button class="button button__in-garbage js-product-btn-in-garbage js-tooltip"
                            data-action="<?=UrlGenerator::toRoute('product/add')?>"
                            data-item-id="<?=$product->id?>"
                            data-toggle="tooltip"
                            title="<?=Lang::get('choose_config')?>"
                            data-target="#modal-add-done-<?=$product->id?>"
                    ><i></i></button>

                    <button class="js-product-quick-order-btn button button-red button__quick-order js-tooltip"
                            data-is-authenticated="<?=(int)User::getObject()->isAuthenticated()?>"
                            data-authentication-action="<?=UrlGenerator::getUrl('login')?>"
                            data-item-id="<?=$product->id?>"
                            data-toggle="tooltip"
                            title="<?=Lang::get('choose_config')?>"
                            data-weight="<?=$product->weight?>"
                            data-authentication-action="<?=UrlGenerator::getUrl('login')?>"
                            data-provider="<?=$product->provider?>"
                            data-action="<?=UrlGenerator::getUrl('order/quick-order')?>"
                            data-loading-text="<?=Lang::get('loading')?>..."
                    ><i></i><?=Lang::get('quick_order')?></button>
                </div>
            </div>
        </div>
    </div>
</section>

<?=Lang::loadJSTranslation(array('inner_delivery_hint'))?>
<? AssetsMin::registerCssFile('css/vendor/jquery.raty.css') ?>
<? AssetsMin::registerJsFile('js/vendor/jquery.raty.js') ?>
<script>
    $(function () {
        var wrapperSelector = '.js-product-<?= $product->id ?>';
        var $wrapper = $(wrapperSelector);
        var maxDots = 5;
        var transformXIntervalNext = -18;
        var transformXIntervalPrev = 18;

        function setBoundries(slick, state) {
            if (state === 'default') {
                slick.find('ul.slick-dots li').eq(4).addClass('n-small-1');
            }
        }
        $wrapper.find('.js-slider-product').on('init', function (event, slick) {
            $(this).find('ul.slick-dots').wrap("<div class='slick-dots-container'></div>");
            $(this).find('ul.slick-dots li').each(function (index) {
                $(this).addClass('dot-index-' + index);
            });
            $(this).find('ul.slick-dots').css('transform', 'translateX(0)');
            setBoundries($(this),'default');
        });

        var transformCount = 0;
        $wrapper.find('.js-slider-product').on('beforeChange', function (event, slick, currentSlide, nextSlide) {
            var totalCount = $(this).find('.slick-dots li').length;
            if (totalCount > maxDots) {
                if (nextSlide > currentSlide) {
                    if ($(this).find('ul.slick-dots li.dot-index-' + nextSlide).hasClass('n-small-1')) {
                        if (!$(this).find('ul.slick-dots li:last-child').hasClass('n-small-1')) {
                            transformCount = transformCount + transformXIntervalNext;
                            $(this).find('ul.slick-dots li.dot-index-' + nextSlide).removeClass('n-small-1');
                            var nextSlidePlusOne = nextSlide + 1;
                            $(this).find('ul.slick-dots li.dot-index-' + nextSlidePlusOne).addClass('n-small-1');
                            $(this).find('ul.slick-dots').css('transform', 'translateX(' + transformCount + 'px)');
                            var pPointer = nextSlide - 3;
                            var pPointerMinusOne = pPointer - 1;
                            $(this).find('ul.slick-dots li').eq(pPointerMinusOne).removeClass('p-small-1');
                            $(this).find('ul.slick-dots li').eq(pPointer).addClass('p-small-1');
                        }
                    }
                }
                else {
                    if ($(this).find('ul.slick-dots li.dot-index-' + nextSlide).hasClass('p-small-1')) {
                        if (!$(this).find('ul.slick-dots li:first-child').hasClass('p-small-1')) {
                            transformCount = transformCount + transformXIntervalPrev;
                            $(this).find('ul.slick-dots li.dot-index-' + nextSlide).removeClass('p-small-1');
                            var nextSlidePlusOne = nextSlide - 1;
                            $(this).find('ul.slick-dots li.dot-index-' + nextSlidePlusOne).addClass('p-small-1');
                            $(this).find('ul.slick-dots').css('transform', 'translateX(' + transformCount + 'px)');
                            var nPointer = currentSlide + 3;
                            var nPointerMinusOne = nPointer - 1;
                            $(this).find('ul.slick-dots li').eq(nPointer).removeClass('n-small-1');
                            $(this).find('ul.slick-dots li').eq(nPointerMinusOne).addClass('n-small-1');
                        }
                    }
                }
            }
        });


        $wrapper.find('.js-slider-product-list').slick({
            responsive: [{
                breakpoint: 1280,
                settings: {
                    slidesToShow: 5,
                    arrows: true,
                    vertical:false
                }
            }],
            infinite: true,
            slidesToShow: 6,
            slidesToScroll: 1,
            fade: false,
            accessibility: true,
            arrows: true,
            centerMode: false,
            slide: wrapperSelector + ' .js-product-media',
            vertical: true,
        });

        var rtl = <?= General::getConfigValue('rtl') ? 'true' : 'false' ?>;
        $wrapper.find('.js-slider-product').slick({
            dots: true,
            slidesToShow: 1,
            slidesToScroll: 1,
            fade: false,
            centerMode: false,
            slide: wrapperSelector + ' .js-product-slide',
            adaptiveHeight: true,
            infinite: false,
            rtl: rtl,
        }).on('beforeChange', function (e) {
            var $wrapper = $(e.currentTarget).closest('.js-product');

            if ($wrapper.find('.video_main:not(visible)')) {
                $wrapper.find('.video_main').trigger('pause');
            }
        });

        $wrapper.find('.js-product-main-photo').on('load', function (e) {
            var $cloudZoom = $(e.currentTarget)
                .closest('.js-product')
                .find('.cloud-zoom');

            if ($cloudZoom.data('zoom')) {
                $cloudZoom.data('zoom').destroy();
            }

            $cloudZoom.CloudZoom();
        });

        $wrapper.find('.js-product-configurator-image').on('afterChangeConfiguratorImage', function (e) {
            var $el = $(e.currentTarget);
            var $wrapper = $el.closest('.js-product');
            var isPropertyActivated = $el.hasClass('active');
            var propertyImgLarge = $el.find('.js-product-config-image').data('imgLarge');

            var $slider = $wrapper.find('.js-slider-product');
            var $slides = $slider.find('.js-product-slide:not(.slick-cloned)');
            var lastSlideIndex = $slides.length - 1;
            var isLastSlideConfig = $slides.last().hasClass('js-product-slide-config');

            if (! isPropertyActivated) {
                $slider.slick('slickGoTo', 0);
                $slider.slick('slickRemove', lastSlideIndex);
            } else if (isLastSlideConfig) {
                $slider.find('.js-product-slide-config img').attr('src', propertyImgLarge);
            } else {
                var $slide = $wrapper.find('.js-product-slide-skeleton .js-product-slide').clone();
                $slide.find('img').attr('src', propertyImgLarge);

                $slider.slick('slickAdd', $slide);
                $slide.find('img').on('load', function () {
                    $slider.slick('slickGoTo', lastSlideIndex + 1);
                });
            }
        });
    });
</script>