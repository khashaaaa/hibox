<?=Plugins::invokeEvent('onItemListRenderStatistics', array('categoryName' => $this->escape($GLOBALS['categoryInfo']['Name'])))?>

<div class="panel-grey panel-product">
    <div class="product-filter">
    <? if (isset($availableSorts) && ! empty($availableSorts)) { ?>
        <form method="post" id="sort_form">
            <div class="select-text"><?=Lang::get('sort_by')?>:</div>
            <? if (! empty($availableSorts)) { ?>
                <div class="select">
                    <select name="sort_by"
                            data-form="sortby-form" class="form-control search-click" onchange="document.getElementById('per_page').submit();">
                        <?php foreach ($pp as $key => $value) {
                        if ($maxFrameSize && $value > $maxFrameSize ) {
                            continue;
                        }
                        ?>
                        <option value="<?=$value?>" <?if ($perpage == $value){?>selected<?}?>><?=$value?></option>
                        <?php } ?>
                    </select>
                </div>
            <? } ?>
        </form>
    <? } ?>

    <? if ($IsProvider) { ?>
        <?  if (! isset($pp)) {
                $pp = array(20, 40, 100);
            }
                $ppValue = $perpage;
                if (!in_array($ppValue, $pp)) {
                    $pp[] = $ppValue;
                    asort($pp);
                }
        ?>
        <form method="GET" id="per_page">
            <select name="per_page" onchange="document.getElementById('per_page').submit();" class="form-control">
                <? foreach ($pp as $key => $value) {
                    if ($maxFrameSize && $value > $maxFrameSize ) {
                    continue;
                }
                ?>
                <option value="<?=$value?>" <?if ($perpage == $value){?>selected<?}?>><?=$value?></option>
                <?php } ?>
            </select>
        </form>
    <? } ?>

    </div>

    <div class="panel-products-views">
        <?=Lang::get('items_rus')?>: <?=$totalcount?>
    </div>

    <div class="panel-products-views">
        <?=Lang::get('shown')?>: <?=Lang::get('from')?> <b><?=($count ? $from + 1 : 0)?></b> <?=Lang::get('to')?>
        <b><? if ($from + $perpage < $count) print $from + $perpage; else print $count; ?></b>
        <?=Lang::get('from2')?>
        <b><?=$count?></b>
    </div>

</div>

<!-- .aside -->
<div class="aside">
    <div class="accordion accordion-menu">
        <? if (isset($hintcats) && count($hintcats) > 0) { ?>
            <div class="card">
                <div class="card-header bg-white nopadding">
                    <h5 class="mb-0">
                        <button class="btn btn-link link pl-0 pr-0 collapsed"
                                type="button"
                                data-toggle="collapse"
                                data-target="#hintcats"
                                aria-expanded="true"
                                aria-controls="collapse2">
                            <?=Lang::get('Perhaps_you_are_interested')?><i></i>
                        </button>
                    </h5>
                </div>
                <div id="hintcats" class="collapse" aria-labelledby="headingThree">
                    <div class="card-body pt-0">
                        <ul>
                            <? $cid = RequestWrapper::getValueSafe('cid');
                               $hasHidden = false; ?>
                            <? foreach ($hintcats as $k => $category) { ?>
                                <? if ($k < 10) { ?>
                                    <li class="item" <?=($cat['id'] == $cid ? 'class="active"' : '')?>>
                                        <a href="<?=General::generateUrl('subcategory', $category)?>"><?=$this->escape($category['name']);?></a>
                                    </li>
                                <? } else {
                                    $hasHidden = true;
                                ?>
                                    <li class="fast-category-hidden">
                                        <a href="/?p=category&cid=<?=$category['id'];?>"> <?=$this->escape($category['name']);?></a>
                                    </li>
                                <? } ?>
                            <? } ?>
                            <? if ($hasHidden) { ?>
                                <li class="item last">
                                    <a href="#" class="dotted" onclick="$('.fast-category-hidden').show();$(this).remove();return false;">
                                        <i class="i-new i-arrow-down i arrowdown"></i><span><?=Lang::get('other_cats')?></span>
                                    </a>
                                </li>
                            <? } ?>
                        </ul>
                    </div>
                </div>
            </div>
        <? } ?>

        <? if (isset($categories) && count($categories) > 0) { ?>
            <div class="card">
                <div class="card-header bg-white nopadding">
                    <h5 class="mb-0">
                        <button class="btn btn-link link pl-0 pr-0 collapsed"
                                type="button"
                                data-toggle="collapse"
                                data-target="#samecat"
                                aria-expanded="true"
                                aria-controls="collapse2">
                            <?=Lang::get('suitable_category')?><i></i>
                        </button>
                    </h5>
                </div>
                <div id="samecat" class="collapse" aria-labelledby="headingThree">
                    <div class="card-body pt-0">
                        <ul>
                            <?  $cid = RequestWrapper::getValueSafe('cid');
                                $hasHidden = false; ?>
                            <? foreach ($categories as $k => $category) { ?>
                                <? if ($k < 10) { ?>
                                    <li class="item" <?=($cat['id'] == $cid ? 'class="active"' : '')?>>
                                        <a href="<?=General::generateUrl('subcategory', $category)?>"><?=$this->escape($category['name']);?></a>
                                    </li>
                                <? } else {
                                    $hasHidden = true; ?>
                                    <li class="fast-category-hidden">
                                        <a href="/?p=category&cid=<?=$category['id'];?>"> <?=$this->escape($category['name']);?></a>
                                    </li>
                                <? } ?>
                            <? } ?>
                            <? if ($hasHidden) { ?>
                                <li class="item last">
                                    <a href="#" class="dotted" onclick="$('.fast-category-hidden').show();$(this).remove();return false;">
                                        <i class="i-new i-arrow-down i arrowdown"></i><span><?=Lang::get('other_cats')?></span>
                                    </a>
                                </li>
                            <? } ?>
                        </ul>
                    </div>
                </div>
            </div>
        <? } ?>

        <? if (isset($subCategories) && is_array($subCategories) && count($subCategories)) { ?>
        <div class="card">
            <div class="card-header bg-white nopadding">
                <h5 class="mb-0">
                    <button class="btn btn-link link pl-0 pr-0 collapsed"
                            type="button"
                            data-toggle="collapse"
                            data-target="#subCategories"
                            aria-expanded="true"
                            aria-controls="collapse2">
                        <?=Lang::get('subcategories')?><i></i>
                    </button>
                </h5>
            </div>
            <div id="subCategories" class="collapse" aria-labelledby="headingThree">
                <div class="card-body pt-0">
                    <ul>
                        <? if (! empty($prevCategoryLink)) { ?>
                            <li class="item">
                                <a <?=(!isset($cid) || $cid == '' ? 'class="active"' : '')?>
                                href="<?=$prevCategoryLink?>"><?=Lang::get('all_categories')?></a>
                            </li>
                        <? } ?>
                        <? if (SCRIPT_NAME == 'search' || SCRIPT_NAME == 'item_list_ajax' || SCRIPT_NAME == 'vendor') {
                            $cid = RequestWrapper::getValueSafe('cid');
                            $hasHidden = false;
                            foreach ($subCategories as $k => $category) {
                                if ($k < 10) {
                                    if (RequestWrapper::getValueSafe('Provider')) {
                                    $url = $baseUrl->DeleteKey('cid')->Add('Provider', RequestWrapper::getValueSafe('Provider'))->Add('SearchMethod', RequestWrapper::getValueSafe('SearchMethod'))->Get();
                                } else {
                                    $url = $baseUrl->DeleteKey('Provider')->DeleteKey('SearchMethod')->DeleteKey('cid')->Get();
                                } ?>
                            <li class="item">
                                <a href="<?=UrlGenerator::generateFullSearchUrl($url,$category['id'],$tmall,RequestWrapper::getValueSafe('Discount')); ?>" <?=($category['id'] == $cid ? 'class="active"' : '')?>>
                                <?=$this->escape($category['name']);?> <? if ($category['itemcount']) { ?>(<?= $category['itemcount'] ?>) <? } ?>
                                </a>
                            </li>
                        <? } else { ?>
                            <? $hasHidden = true; ?>
                            <li class="item left-category-hidden">
                                <a href="<?=UrlGenerator::generateFullSearchUrl($url,$category['id'],$tmall,RequestWrapper::getValueSafe('Discount')); ?>" <?=($category['id'] == $cid ? 'class="active"' : '')?>>
                                <?=$this->escape($category['name']);?> <? if ($category['itemcount']) { ?>(<?= $category['itemcount'] ?>) <? } ?>
                                </a>
                            </li>
                            <? } ?>
                        <? } ?>
                        <? if ($hasHidden) { ?>
                            <li class="item last">
                                <a href="#" class="dotted" onclick="$('.left-category-hidden').show();$(this).remove();return false;">
                                    <i class="i-new i-arrow-down i arrowdown"></i><span><?=Lang::get('other_cats')?></span>
                                </a>
                            </li>
                        <? } ?>
                        <? } ?>

                        <? if (SCRIPT_NAME == 'subcategory' || SCRIPT_NAME == 'category') {
                            $hasHidden = false;
                            foreach ($subCategories as $k => $cat) {
                                if ($k >= 10) {
                                    $classLink = 'class="item left-category-hidden"';
                                }
                                if (RequestWrapper::getValueSafe('Provider')) {
                                    $cat['Provider'] = RequestWrapper::getValueSafe('Provider');
                                    $cat['SearchMethod']= RequestWrapper::getValueSafe('SearchMethod');
                                }
                                if (!isset($cat['ishidden']) || $cat['ishidden'] == 'false') {
                                    if (!isset($cat['isparent']) || $cat['isparent'] == 'false') { ?>
                                        <li <?=$classLink?>>
                                            <a href="<?=UrlGenerator::generateFullCatUrl('category',$cat,$tmall,RequestWrapper::getValueSafe('Discount'))?>"><?=$this->escape($cat['name'])?></a>
                                        </li>
                                    <? } else { ?>
                                        <li <?=$classLink?>>
                                            <a href="<?=UrlGenerator::generateFullCatUrl('subcategory',$cat,$tmall,RequestWrapper::getValueSafe('Discount'))?>"><?=$this->escape($cat['name'])?></a>
                                        </li>
                                    <? } ?>
                                <? } ?>
                            <? } ?>
                            <? if (count($subCategories) > 10) { ?>
                                <li class="item last">
                                    <a href="#" class="dotted" onclick="$('.left-category-hidden').show();$(this).remove();return false;">
                                        <i class="i-new i-arrow-down i arrowdown"></i><span><?=Lang::get('other_cats')?></span>
                                    </a>
                                </li>
                            <? } ?>
                        <? }?>
                    </ul>
                </div>
            </div>
        </div>
        <? } ?>
    </div>
</div>

<!-- .main -->
<div class="main">
    <div class="listing-wrap">
    <? if (!$no_search_request) { ?>
        <? if (!empty($currentImageUrl)) { ?>
            <div class="row old-search-content_image">
                <div class="col-md-2">
                    <div class="search-img-wrapper">
                        <img src="<?=$currentImageUrl?>"/>
                    </div>
                </div>
                <div class="col-md-10">
                    <? $filters = RequestWrapper::get('filters'); ?>
                    <? foreach ($searchProperties as $searchProperty) { ?>
                        <? if ($searchProperty['IsCategory']) { ?>
                            <p><label class="panel-title"><?= $searchProperty['name'] ?></label></p>
                            <p>
                                <? $filterId = $searchProperty['Id']; ?>
                                <? foreach ($searchProperty['Values'] as $value) { ?>
                                    <?
                                        $filterValueId = $value['Id'];
                                        $active = (!is_null($filters) && isset($filters[$filterId]) && !empty($filters[$filterId][$filterValueId]));

                                        $url = clone $baseUrl;
                                        $newFilters = $filters;
                                        if ($active) {
                                            unset($newFilters[$filterId][$filterValueId]);
                                        } else {
                                            unset($newFilters[$filterId]);
                                            $newFilters[$filterId][$filterValueId] = 1;
                                        }
                                        $url = $url->SetValue('filters', $newFilters);

                                    ?>
                                    <a href="<?=$url->Get()?>" class="btn btn-default <?= $active ? 'active' : ''?>">
                                        <?= $active ? '<span class="glyphicon glyphicon-ok"></span>' : ''?>
                                        <?=$value['name']?>
                                    </a>
                                <? }?>
                            </p>
                        <? } ?>
                    <? } ?>
                </div>
            </div>
        <? } ?>

        <div class="fll col240">
        <div id="overlay"></div>
        <? if ($vendorInfo) { ?>
        <div class="bgr-block mb20">
            <table class="info f11">
                <tbody>
                <tr>
                    <td><?=Lang::get('name')?>:</td>
                    <td><b><?=$this->escape($vendorInfo['displayname'])?></b></td>
                </tr>
                <?
                if ($vendorInfo['shopname']) { ?>
                <tr>
                    <td><?=Lang::get('vendor_shop_name')?>:</td>
                    <td><b><?=$vendorInfo['shopname']?></b></td>
                </tr>
                <? }
                if ($vendorInfo['location']['city']) {
                ?>
                <tr>
                    <td><?=Lang::get('placed_in')?>:</td>
                    <td><b><?=$vendorInfo['location']['city']?> (<?=$vendorInfo['location']['state']?>)</b></td>
                </tr>
                <? }
                if ($vendorInfo['location']['city']) {
                ?>
                <tr>
                    <td><?=Lang::get('features')?>:</td>
                    <td><b><?=$vendorInfo['location']['city']?></b></td>
                </tr>
                <? }
                if ($vendorInfo['credit']['TotalFeedbacks']) {
                ?>
                <tr>
                    <td><?=Lang::get('responses')?>:</td>
                    <td><b><?=$vendorInfo['credit']['TotalFeedbacks']?></b></td>
                </tr>
                <? }
                if ($vendorInfo['credit']['PositiveFeedbacks']) {
                ?>
                <tr>
                    <td><?=Lang::get('positive')?>:</td>
                    <td><b><?=$vendorInfo['credit']['PositiveFeedbacks']?></b></td>
                </tr>
                <? } ?>
                <? if($vendorInfo['Scores']['deliveryscore']) { ?>
                <tr>
                    <td><?=Lang::get('delivery_score')?>:</td>
                    <td>
                        <b>
                            <?=$vendorInfo['Scores']['deliveryscore']?>
                        </b>
                    </td>
                </tr>
                <? } ?>
                <? if($vendorInfo['Scores']['itemscore']) { ?>
                <tr>
                    <td><?=Lang::get('item_score')?>:</td>
                    <td>
                        <b>
                            <?=$vendorInfo['Scores']['itemscore']?>
                        </b>
                    </td>
                </tr>
                <? } ?>
                <? if($vendorInfo['Scores']['servicescore']) { ?>
                <tr>
                    <td><?=Lang::get('service_score')?>:</td>
                    <td>
                        <b>
                            <?=$vendorInfo['Scores']['servicescore']?>
                        </b>
                    </td>
                </tr>
                <? } ?>
                <? if ($vendorInfo['credit']['level']) { ?>
                <tr>
                    <td><?=Lang::get('rating')?>:</td>
                    <td>
                        <? if (!General::getConfigValue('vendor_rating_view_as_number')) { ?>
                            <span class="raiting">
                                <i class="i-raiting raiting_<?= $vendorInfo['credit']['level'] ?>"></i>
                            </span>
                        <? } else { ?>
                            <span class="raiting">
                                <span class="rating_number raiting_<?=$vendorInfo['credit']['level']?>">
                                    <?=$vendorInfo['credit']['level']?>
                                </span>
                            </span>
                        <? } ?>
                    </td>
                </tr>
                <? } ?>
                <? if (isset($vendorInfo['FeaturedValues'])) { ?>
                    <? if (isset($vendorInfo['FeaturedValues']['ItemReviewRating'])) { ?>
                        <tr>
                            <td><?=Lang::get('ItemReviewRating')?>:</td>
                            <td>
                                <b>
                                    <?=$vendorInfo['FeaturedValues']['ItemReviewRating']?>
                                </b>
                            </td>
                        </tr>
                    <? } ?>
                <? } ?>
                <tr>
                    <td colspan="2" style="text-align: right">
                        <a href="#" id="add-vendor-to-favourites" style="<?= $vendorInfo['favoriteItemId'] ? 'display:none;' : ''?>" vendorId="<?= $this->escape($vendorInfo['id']) ?>" class="btn-small btn-add fll">
                            <span><?=Lang::get('add_vendor_to_favourites')?></span>
                        </a>
                        <a href="#" id="vendor-added-to-favourites" style="<?= $vendorInfo['favoriteItemId'] ? '' : 'display:none;'?>" vendorId="<?= $this->escape($vendorInfo['id']) ?>" class="btn-small btn-add fll btn-remove btn-delete-item " itemid="<?=$vendorInfo['favoriteItemId']?>">
                            <span><?=Lang::get('drop_vendor_from_fav')?></span>
                        </a>
                    </td>
                </tr>
            </table>

        </div>
        <? } ?>

        <?php
        /**
         * @var UrlWrapper $baseUrl
         * @var string $CurrentSearchType
         * @var bool $IsProvider
         * @var array $cachedSearchTypesInfo
         */

        $pageUrl = clone $baseUrl;
        $allSearchTypes = isset($SearchTypes) && is_array($SearchTypes) && SCRIPT_NAME != 'vendor' ? $SearchTypes : array();
        $activeSearchTypes = array();
        $isMultiSearch = General::getConfigValue('use_multi_search') && $CurrentSearchType != 'Warehouse_Default';
        if (! empty($сategoryInfo['SearchMethod'])) {
            $isMultiSearch = false;
        }
        foreach ($allFeatures as $feature) {
            $pageUrl->DeleteKey($feature);
        }
        if($isMultiSearch) {
            $activeSearchTypes[] = array(
                'url' => $pageUrl->DeleteKey('Provider')->DeleteKey('SearchMethod')->Get(),
                'title' => Lang::get('multisearch'),
                'active' => !($IsProvider == 'active'),
                'totalCount' => false,
                'offset' => 0
            );
        }
        foreach($allSearchTypes as $order => $searchType) {
            $searchTypeInfo = ! empty($cachedSearchTypesInfo[$searchType['Provider'].'_'.$searchType['SearchMethod']]) ?
                $cachedSearchTypesInfo[$searchType['Provider'].'_'.$searchType['SearchMethod']] : false;

            $newPageUrl = clone $pageUrl;
            $newSearchType = array(
                'url' => $newPageUrl->DeleteKey('Provider')->DeleteKey('SearchMethod')->DeleteKey('filters')
                    ->Add('Provider', $searchType['Alias'])->Add('SearchMethod', $searchType['SearchMethod'])->Get(),
                'title' => $searchType['DisplayName'],
                'active' => (($CurrentSearchType == $searchType['Provider'].'_'.$searchType['SearchMethod'])
                            && !RequestWrapper::getValueSafe('Discount'))
                            || ($order == 0 && !$isMultiSearch && !$CurrentSearchType),
                'totalCount' => $searchTypeInfo ? $searchTypeInfo['totalcount'] : false,
                'offset' => 0
            );
            if (($CurrentSearchType == 'Warehouse_Default') and ($searchType['Provider'].'_'.$searchType['SearchMethod'] != 'Warehouse_Default')) {
                continue;
            }
            if (($newSearchType['totalCount'] === false && $searchType['Provider'].'_'.$searchType['SearchMethod'] != 'Warehouse_Default')
                || $newSearchType['totalCount'] > 0) {
                if (empty($сategoryInfo['SearchMethod']) || ($CurrentSearchType == $searchType['Provider'].'_'.$searchType['SearchMethod'])) {
                    $activeSearchTypes[] = $newSearchType;
                }
            }
            if (! empty($searchType['Features'])) {
                foreach($searchType['Features'] as $feature) {
                    if ($feature['CanBeTrue'] == 'true') {
                        $plusText = $feature['CanBeFalse'] == 'true' ? ' +' : '';
                        if (empty($сategoryInfo['SearchMethod']) || ($CurrentSearchType == $searchType['Provider'].'_'.$searchType['SearchMethod'])) {
                            $activeSearchTypes[] = array(
                                'url' => $pageUrl->Add($feature['Name'], 'true')->Get(),
                                'urlWithoutFeature' => $pageUrl->DeleteKey($feature['Name'])->Get(),
                                'title' => ! empty($feature['ForTrue']) ? $feature['ForTrue'] : $feature['DisplayName'] . $plusText,
                                'active' => RequestWrapper::getValueSafe($feature['Name']) && ($CurrentSearchType == $searchType['Provider'].'_'.$searchType['SearchMethod']),
                                'totalCount' => false,
                                'offset' => 1,
                                'css' => 'feature-' . $feature['Name'],
                            );
                        }
                    }
                    if ($feature['CanBeFalse'] == 'true') {
                        $plusText = $feature['CanBeTrue'] == 'true' ? ' -' : '';
                        $activeSearchTypes[] = array(
                            'url' => $pageUrl->Add($feature['Name'], 'false')->Get(),
                            'urlWithoutFeature' => $pageUrl->DeleteKey($feature['Name'])->Get(),
                            'title' => ! empty($feature['ForFalse']) ? $feature['ForFalse'] : $feature['DisplayName'] . $plusText,
                            'active' => RequestWrapper::getValueSafe($feature['Name']),
                            'totalCount' => false,
                            'offset' => 1,
                            'css' => 'feature-' . $feature['Name'],
                        );
                    }
                }
            }
        }
        ?>
        <? if(count($activeSearchTypes) > 0  && ! $vendorInfo ){ ?>
        <div class="bgr-block mb20">
            <div class="titlecat bbn"><?=Lang::get('supplier_type')?></div>

            <ul class="listitem">
                <?php foreach($activeSearchTypes as $type) { ?>
                    <li class="item">
                        <a class="<?=$type['active'] ? 'active' : ''?> <?=$type['offset']==1 ? 'isFeature' : 'noFeature';?> <?= (!empty($type['css'])) ? $type['css'] : '' ?>"
                           href="<?=$type['active'] ? $type['urlWithoutFeature'] : $type['url']?>">
                            <?=$type['title']?>
                            <? if ($type['totalCount'] !== false) { ?>
                                (<span style="font-size:10px;">
                                    <?=$type['totalCount']?>
                                </span>)
                            <? } ?>
                        </a>
                        <? if (($type['offset']==1) && ($type['active'])) { ?>
                            <a href="<?=$type['urlWithoutFeature']?>" class="i-new i-delete  i delete go"></a>
                        <? } ?>
                    </li>
                <?php } ?>
            </ul>
        </div>
        <? } ?>

        <div class="bgr-block mb20">
            <?=$SearchProp?>
        </div>
    </div>

        <? if (@$GLOBALS['brandinfo']) { ?>
            <div class="wrap clrfix brand-info">
                <i><img src="<?=$GLOBALS['brandinfo']['PictureUrl']?>" style="float:left; margin: 0 10px 10px 0"/></i>
                <?=$GLOBALS['brandinfo']['Description']?>
            </div>
        <? } ?>
        <?
        $searchParamsInner = General::getSearchParams();
        $showSearchBar = General::isShowSearchBar();
        if ($showSearchBar && $totalcount == 0 && !$searchParamsInner['search']) {
            // пустой результат поиска без строки поиска
            $showSearchBar = false;
        }
        if (isset($availableSearchInner) && !$availableSearchInner) {
            $showSearchBar = false;
        }
        ?>

        <? if (! empty($itemlist)) { ?>
            <? if (in_array('Seo2', General::$enabledFeatures)) {
                $url = '/item?';
            } else {
                $url = '/?p=item&';
            } ?>

            <? foreach ($itemlist as $idx => $item) { ?>
                <? if ((General::getConfigValue('hide_item_for_restrictions')) && ($item['IsSellAllowed'] === 'false') && ($item['SellDisallowReason'] === 'IsFiltered')) { ?>
                    <?=View::fetchTemplate('item-replace-text', 'item_replace_text', '/blocks/search/', array('text' => Lang::get('IsFiltered')))?>
                <? } elseif ($item['ErrorCode'] == 'Ok') { ?>
                    <? $paramsByItemUrl = array('vendorId' => $item['VendorId']); ?>
                    <? if ($GLOBALS['categoryInfo']['IsSearch'] && $GLOBALS['categoryInfo']['IsSearch'] == 'true') { ?>
                        <? $paramsByItemUrl['cid'] = $GLOBALS['categoryInfo']['id']; ?>
                    <? } ?>
                    <? $itemUrl = UrlGenerator::generateItemUrl($item['id'], $paramsByItemUrl);                ?>
                    <div class="item-product <?if ($item['IsSellAllowed'] === 'false') { ?> is-sell-allowed-false<? } ?> <?=ProductsHelper::formatFeatureListForCss($item['Features'])?>">
                        <div class="item-product-inside">
                            <?=ProductsHelper::getHtmlFeatureListForLabel($item['Features'])?>
                            <div class="item-product__img">
                                <a href="<?=$itemUrl ?>"
                                   data-product-id="<?=$item['id']?>"
                                   data-product-url="<?=UrlGenerator::toRoute('item', ['id' => $item['id']])?>"
                                   class="item-product__img-a item-list_img-wrap js-product-item"
                                >
                                    <? if (ProductsHelper::getMediumImage($item)) { ?>
                                        <div class="product-image-wrapper">
                                            <img class="check-noimg" src="<?= ProductsHelper::getMediumImage($item) ?>" alt="<?=$this->escape($item['Title'])?>" itemprop="image">
                                        </div>
                                    <? } ?>
                                    <div class="item-product__img_hover">
                                        <span class="button btn-quick-look js-product-btn-quick-look"><?=Lang::get('quick_look')?></span>
                                    </div>
                                </a>
                            </div>

                            <? if ($item['Title']) { ?>
                                <a href="<?=$itemUrl?>" class="item-product__title"><?=$itemTitile = (! empty($item['Title'])) ? $this->escape($item['Title']) : $this->escape($item['VendorName']);?></a>
                            <? } ?>

                            <div class="item-product__price">
                                <? if (General::getCurrencyPromoPrice($item)) { ?>
                                    <div class="item-product__price_new"><?=General::getCurrencyPromoPrice($item, ['addItemprop' => true])?></div>
                                    <div class="price-old__wrap">
                                        <div class="item-product__price_old"><span><?=General::getCurrencyPrice($item, ['addItemprop' => true])?></span></div>
                                        <? if ($item['PromotionPricePercent']) { ?>
                                            <div class="item-product__price_discount">- <?=$item['PromotionPricePercent'][0]['Val']?>%</div>
                                        <? } ?>
                                    </div>
                                <? } else {?>
                                    <div class="item-product__price_new"><?=General::getCurrencyPrice($item, ['addItemprop' => true])?></div>
                                <? } ?>

                                <? if (!empty($item['QuantityRanges'])) { ?>
                                    <table class="table quantity-ranges" title="<?=Lang::get('Prices_ranges')?>">
                                        <tbody>
                                            <tr>
                                                <? foreach ($item['QuantityRanges'] as $range) { ?>
                                                    <th><?=$range['DisplayRange']?></th>
                                                <? } ?>
                                            </tr>
                                            <tr>
                                                <? foreach ($item['QuantityRanges'] as $range) { ?>
                                                    <td><?=$range['Price']?></td>
                                                <? } ?>
                                            </tr>
                                        </tbody>
                                    </table>
                                <? } ?>
                            </div>

                            <? if (isset($item['FeaturedValues']['SalesInLast30Days']) && $item['FeaturedValues']['SalesInLast30Days'] !== null) { ?>
                                <div class="item-product__sold">
                                    <div class="sold-block">
                                        <span title="<?=Lang::get('sales_volume1')?>"><?=Lang::get('sold')?>: <?=$item['FeaturedValues']['SalesInLast30Days']?></span>
                                    </div>
                                </div>
                            <? } ?>

                            <? if (!is_null($item->itemReviewRating)) { ?>
                                <div class="item-product__rating">
                                    <span><?=Lang::get('vendor_rating_baserus')?>:</span>
                                    <div class="ratyScore ratyScore-sm" style="text-align: center;" data-score="<?=$item->itemReviewRating?>"></div>
                                </div>
                            <? } ?>

                            <div class="item-product__bottom-block">
                                <div class="item-product-bottom-inside">
                                    <? if (isset($item['vendorscore']) && $item['vendorscore'] > 0) { ?>
                                        <? if (!General::getConfigValue('vendor_rating_view_as_number')) { ?>
                                            <i class="i-raiting <?=$item['provider']?> raiting_<?=$item['vendorscore']?>"></i>
                                        <? } else { ?>
                                            <span class="raiting">
                                                <span class="rating_number raiting_<?=$item['vendorscore']?>">
                                                    <?=Lang::get('rating')?>:&nbsp;<?=$item['vendorscore']?>
                                                </span>
                                            </span>
                                        <? } ?>
                                    <? } ?>
                                    <? if ($this->escape($item['VendorName'])) { ?>
                                        <div class="item-product__seller"><?=Lang::get('vendor')?>: <?= VendorHelper::generateLink($this->escape($item['VendorId']), $this->escape($item['VendorName']), array('class' => 'vendor-url'))?></div>
                                    <? } ?>
                                    <? if (count($item['pictures']) > 1) { ?>
                                        <ul class="more-photos">
                                            <? foreach ($item['pictures'] as $picture) { ?>
                                                <li class="other-photo"
                                                    img-src="<?=$picture['medium']?>"
                                                    style="background-image: url(<?=$picture['small']?>)"
                                                ></li>
                                            <? } ?>
                                        </ul>
                                    <? } ?>
                                    <div class="item-product__add hidden">
                                        <a href="javascript:void(0)" class="add-favorite"><i></i> <?=Lang::get('Add_item_to_fav')?></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <? } else { ?>
                    <div class="item-product">
                        <?=General::viewFetch('other/product/display-error', array('vars' => array('item' => $item)))?>
                    </div>
                <? } ?>
            <? } ?>
        <? } else { ?>
            <h2><span><?=Lang::get('nothing_found')?></span></h2>
        <? } ?>


        <? if(Session::checkErrors()){ ?>
            <?
            $errorCode = Session::getErrorCode();
            $subErrorCode = Session::getSubErrorCode();
            $errorDescription = Session::getErrorDescription();
            ?>
            <? if ($errorCode === 'NotAvailable' && $subErrorCode === 'External_ProviderTemporaryUnavailable') { ?>
                <h2 class="item-list-error"><?=Lang::get('SearchErrorProviderTemporaryUnavailable')?></h2>
            <? } else if(Lang::get('Search:' . $errorCode) == 'Search:'.$errorCode) { ?>
                <h2 class="item-list-error"><?=$errorCode?></h2>
                <strong><?=$errorDescription?></strong>
            <? } else { ?>
                <h2 class="item-list-error"><?=Lang::get('Search:'.$errorCode)?></h2>
            <? } ?>
         <? } ?>

        <? if (! $checkMultiSearch) { ?>
            <?
                $cid = RequestWrapper::getValueSafe('cid');
                if($cid)
                   $baseUrl->Add('cid', $cid);
                $baseUrl->DeleteKey('Provider')->DeleteKey('SearchMethod');
                if (RequestWrapper::getValueSafe('Provider'))
                   $baseUrl->Add('Provider', RequestWrapper::getValueSafe('Provider'))->Add('SearchMethod', RequestWrapper::getValueSafe('SearchMethod'));
                if (RequestWrapper::getValueSafe('Discount'))
                   $baseUrl->Add('Discount', 'true');
            ?>
            <? $page_count_print = General::getConfigValue('pager_count_print') ? General::getConfigValue('pager_count_print') : '2'; ?>
            <? $curpage = floor($from / $perpage) + 1 ?>
            <?
            if (isset($lastSearchProvider) && $lastSearchProvider['totalCount'] >= 20) {
                $maxpage = $maximumPageCount; //ceil($lastSearchProvider['totalCount'] / $perpage) > 40 ? 40 : ceil($lastSearchProvider['totalCount'] / $perpage);
                $baseUrl->DeleteKey('Provider')->DeleteKey('SearchMethod');
                $lastProvider = explode("_", $lastSearchProvider['key']);
                $baseUrl->Add('Provider', $lastProvider[0])->Add('SearchMethod', $lastProvider[1]);
            } else {
                $maxpage = $maximumPageCount;
                //$maxpage = ceil($maxCountPagination / $perpage);
            } ?>

            <? if ($maxpage > 1) { ?>
                <ul class="pagination">
                    <? if ($curpage != 1) { ?>
                        <li class="pagination_prev"><a href="<?=$baseUrl->DeleteKey('from')->Add('from',$from - $perpage)->Get()?>">&laquo;</a></li>
                    <? } ?>

                    <? if ($curpage > ($page_count_print + 1)) { ?>
                        <li><a href="<?=$baseUrl->DeleteKey('from')->Add('from',0)->Get()?>">1</a></li>
                    <? } ?>
                    <? if ($curpage > ($page_count_print + 2)) { ?>
                        <li class="pagination_skip disabled"><a href="javascript:void(0)"></a></li>
                    <? } ?>
                    <? for ($i = max(1, $curpage - $page_count_print); $i <= min($maxpage, $curpage + $page_count_print); $i++) { ?>
                        <? if ($curpage == $i) { ?>
                            <li class="page-item active"><a href="<?=$baseUrl->DeleteKey('from')->Add('from',($i - 1) * $perpage)->Get()?>" class="search-click page-link"><?=$i?></a></li>
                        <? } else { ?>
                            <li><a href="<?=$baseUrl->DeleteKey('from')->Add('from',($i - 1) * $perpage)->Get()?>"><?=$i?></a></li>
                        <? } ?>
                    <? } ?>
                    <? if ($curpage < $maxpage - ($page_count_print + 1)) { ?>
                        <li class="pagination_skip disabled"><a href="javascript:void(0)"></a></li>
                    <? } ?>
                    <? if ($curpage < $maxpage - $page_count_print) { ?>
                        <li><a href="<?=$baseUrl->DeleteKey('from')->Add('from',($maxpage - 1) * $perpage)->Get()?>"><?=$maxpage?></a></li>
                    <? } ?>

                    <? if ($maxpage > 1 && !($curpage >= $maxpage)) { ?>
                        <li class="pagination_next"><a href="<?=$baseUrl->DeleteKey('from')->Add('from',$from + $perpage)->Get()?>">&raquo;</a></li>
                    <? } ?>
                </ul>
            <? } ?>
        <? } ?>
    <? } else { ?>
        <h2><span><?=Lang::get('No_search_reason_' . $no_search_request_reason)?></span></h2>
    <? } ?>
    </div>
</div>
<script src="js/itemListFilters.js?<?=CFG_SITE_VERSION;?>"></script>
<?=Plugins::invokeEvent('onItemListCustom')?>
<? if (isset ($_COOKIE['ftitle'])&&$_COOKIE['ftitle']=='closed'):?>
<!--noindex-->
<script>
    $(function(){
        $('.ftitle').click();
    });
</script>
<!--/noindex-->
<?endif;?>