

<div class="spacer mb20"><div class="wrap clrfix"></div></div>

<? if (! General::getConfigValue('hide_item_title') || $iteminfo['IsTitleManuallyTranslated'] == 'true') { ?>
<div class="bigtitle">
    <div class="wrap clrfix">
        <h1><?=$this->escape($iteminfo['title'])?></h1>
    </div>
</div>
<? } ?>

<!-- .main -->
<div class="main <?=ProductsHelper::formatFeatureListForCss((array)$iteminfo['Features'])?>"><div class="wrap clrfix">
<div class="fll col690 iteminfo" id="overlay-wrapper">
<div id="overlay"></div>

<div class="bproduct clrfix">
    <h2 class="mb25"><span><?=Lang::get('product_info')?></span></h2>
</div>

            <div class="fll col330">
                <div class="bprd">
                    <?=ProductsHelper::getHtmlFeatureListForLabel((array)$iteminfo['Features'])?>
                    <ul class="lproduct flin w310li clrfix">
                        <? if (!empty($iteminfo['Videos'])) { ?>
                            <? $video = reset($iteminfo['Videos']); ?>
                            <li class="pic">
                                <video src="<?=$video['Url']?>" poster="<?=$video['PreviewUrl']?>" controls muted autoplay></video>
                            </li>
                        <? } else {?>
                        <li class="pic">
                            <a href="<?= ProductsHelper::getLargeImage($iteminfo) ?>" class="cboxElement pictures" id="main-image-href" alt="<?=$this->escape($iteminfo['title'])?>" title="<?=$this->escape($iteminfo['title'])?>">
                                <i><img class="main-image" src="<?= ProductsHelper::getImage($iteminfo, 'medium') ?>" default="css/i/default-image.gif" alt="" width="310" /></i>
                                <ins></ins>
                            </a>
                        </li>
                        <? } ?>
                        <li id="tpl-main-image" class="pic hidden">
                            <a href="<?= ProductsHelper::getLargeImage($iteminfo) ?>" id="main-image-href" alt="<?=$this->escape($iteminfo['title'])?>" title="<?=$this->escape($iteminfo['title'])?>">
                                <i><img class="main-image" src="<?= ProductsHelper::getImage($iteminfo, 'medium') ?>" default="css/i/default-image.gif" alt="" width="310" /></i>
                                <ins></ins>
                            </a>
                        </li>
                        <li id="tpl-main-video" class="pic hidden">
                            <video src="" poster="" controls muted autoplay></video>
                        </li>
                    </ul>
                    <ul class="lproduct flin w320 w70li clrfix">
                        <? if (isset($iteminfo['Videos'])) { ?>
                            <? foreach ($iteminfo['Videos'] as $video) { ?>
                                <li class="video-item pic">
                                    <a href="javascript:void(0)" class="switch">
                                        <video src="<?=$video['Url']?>" poster="<?=$video['PreviewUrl']?>"></video>
                                        <div class="circle">
                                            <div class="triangle-right"></div>
                                        </div>
                                        <ins></ins>
                                    </a>
                                </li>

                <? } ?>
            <? } ?>
            <? if (isset($iteminfo['image_path']) ) { ?>
            <li class="image-item pic">
                <a href="<?=$iteminfo['image_path']?>" class="switch pictures" mainpic="<?=$iteminfo['image_path']?>" mini-pic="<?=$iteminfo['image_path']?>">
                    <i><img src="<?=$iteminfo['image_path'] ?>" alt="" width="70" /></i>
                    <ins></ins>
                </a>
            </li>
            <? } ?>
            <? if (is_array($iteminfo['pictures'])) foreach ($iteminfo['pictures'] as $item) { ?>
            <li class="image-item pic">
                <a href="<?=$item['large']?>" class="switch pictures" mainpic="<?=$item['url']?>" mini-pic="<?=$item['medium']?>">
                    <i><img src="<?=$item['small'] ?>" alt="" width="70" /></i>
                    <ins></ins>
                </a>
            </li>
            <? } ?>
        </ul>
    </div>
    <div class="share_social">
    <? $socialNetworks = InstanceProvider::getObject()->GetSocialNetworks(); ?>
    <? if (!$socialNetworks->GetCommonShareWidget()) { ?>
        <div class="share42init" data-path="/i/"></div>
        <? if (Session::getActiveLang() == 'ru') { ?>
            <script type="text/javascript" src="js/share42.js?<?=CFG_SITE_VERSION;?>"></script>
        <? } else { ?>
            <script type="text/javascript" src="js/share42-en.js?<?=CFG_SITE_VERSION;?>"></script>
        <? } ?>
    <? } elseif ($socialNetworks->GetCommonShareWidget() == 'none') { ?>
    <? } else {
        echo $socialNetworks->GetCommonShareWidget();
    } ?>
    </div>
</div>
<div class="flr col340">
<div class="btitle f11 mb10 clrfix">

    <div class="fll"><?=Lang::get('good_code')?> <b><?= $iteminfo['id'] ?></b></div>
    <? if ((! General::getConfigValue('hide_taobao_link') || $admin)
        && empty($isWarehouseProduct)
        && !$isFromExtendedSearch
        && !empty($iteminfo['externalitemurl'])) { ?>
        <? $searchName = ($isYahooProduct) ? ' Yahoo' : ' Taobao.com'; ?>
        <div class="flr"><a target="_blank" rel="nofollow" href="<?= $iteminfo['externalitemurl'] ?>" alt="<?=Lang::get('link_to_original')?>" title="<?=Lang::get('link_to_original')?> "><?=Lang::get('link_to_original')?></a></div>
    <? } ?>
</div>
<div class="bgr-block bx5">
    <? if($iteminfo['configurations']){ ?>
        <div class="titlecat bbn"><?=Lang::get('select_configuration')?>:</div>
    <? } ?>

    <table class="info infoitem f11">
        <!--noindex-->
        <script type="text/javascript">
            configurations = {};
        </script>
        <!--/noindex-->
        <? if(is_array($iteminfo['configurations'])) { ?>
        <? foreach ($iteminfo['configurations'] as $configuration) { ?>
            <!--noindex-->
            <script type="text/javascript">
                configurations['<?= $configuration['id'] ?>'] = {
                    cname: '<?= $this->escape($configuration['name']) ?>',
                    val: {}
                };
            </script>
            <!--/noindex-->
        <? } ?>
        <? foreach ($iteminfo['configurations'] as $configuration) { ?>

            <tr class="item-configuration">
                <td class="w100" data-id="cname<?= $configuration['id'] ?>" config_chy="<?= $configuration['name_cny'] ?>:">
                    <?= $configuration['name'] ?>:
                </td>
                <td>
                    <? $f = false;
                       foreach ($configuration['values'] as $value) {
                           if (@$value['miniimageurl']) $f = true;
                       }
                       if (isset($iteminfo['HasHierarchicalConfigurators'])) {
                            $checkHierarchy = ($iteminfo['HasHierarchicalConfigurators'] == 'false') ? true : false;
                       } else {
                            $checkHierarchy = true;
                       }
                       if($f && $checkHierarchy) { ?>
                        <ul class="list_minipic clearfix" data-id="list_<?=$this->escape(($configuration['id']))?>">
                            <? $i = 0; ?>
                            <? foreach ($configuration['values'] as $value) { ?>
                            <? $name = (!empty($value['alias'])) ? $value['alias'] : $value['name']; ?>
                            <? $class_image = (!$i) ? 'list_minipic_selected' : ''; ?>
                            <? $original_image = (!empty($value['imageurl'])) ? $value['imageurl'] : $iteminfo['mainpictureurl']; ?>
                                <? if (empty($value['miniimageurl'])) $value['miniimageurl'] = '/i/noimg.png'; ?>
                                <li title="<?=$name?>" class="<?=$class_image?>" config-value-id="<?=$value['id']?>">
                                    <a style="background:url(<?=$value['miniimageurl']?>) center no-repeat;"
                                       original-image="<?=$original_image?>"
                                       href="javascript:void(0)"
                                    >
                                        <div class="config-overlay"></div>
                                        <span><?=$name?></span>
                                    </a>
                                    <i>&nbsp;</i>
                                </li>
                                <? $i++; ?>
                            <? } ?>
                        </ul>
                       <!--noindex-->
                        <script type="text/javascript">
                            $(document).ready(function () {
                                var items = $("ul[data-id='list_<?= $configuration["id"]?>'] li");
                                items.click(function(){
                                    var configId = $(this).attr('config-value-id');
                                    $("select[data-id='<?= $configuration["id"]?>'] option")
                                        .each(function() {
                                            this.selected = ($(this).val() == configId);
                                        });
                                    $("select[data-id='<?= $configuration["id"]?>']").change();
                                    return false;
                                });
                            });
                        </script>
                        <!--/noindex-->
                        <select style="display:none;" name="<?= $configuration['id'] ?>" data-id="<?= $configuration['id'] ?>" onchange="changeconfig()" class="w200">
                            <? foreach ($configuration['values'] as $value) { ?>
                            <!--noindex-->
                            <script type="text/javascript">
                                configurations['<?= $configuration['id'] ?>']['val']['<?= $value['id'] ?>'] =
                                        '<?= $value['alias'] ? $value['alias'] : $value['name'] ?>';
                            </script>
                            <!--/noindex-->
                            <option value="<?= $value['id'] ?>" id="val<?= $value['id'] ?>"
                                    config_chy="<? if (!empty($value['alias_cny'])) { ?><?= $value['alias_cny'] ?><? } else { ?><?= $value['name_cny'] ?><? } ?>"
                                    >
                                <? if (!empty($value['alias'])) { ?><?= $value['alias'] ?><? } else { ?><?= $value['name'] ?><? } ?>
                            </option>
                            <? } ?>
                        </select>
                    <? } else { ?>
                        <select name="<?= $configuration['id'] ?>" data-id="<?= $configuration['id'] ?>" onchange="changeconfig()" class="w200">
                            <? foreach ($configuration['values'] as $value) { ?>
                                <!--noindex-->
                                <script type="text/javascript">
                                    configurations['<?= $configuration['id'] ?>']['val']['<?= $value['id'] ?>'] =
                                            '<?= $value['alias'] ? $value['alias'] : $value['name'] ?>';
                                </script>
                                <!--/noindex-->
                                <option value="<?= $value['id'] ?>"
                                        id="val<?= $value['id'] ?>"
                                        config-value-id="<?= $value['id'] ?>"
                                        config_chy="<? if (!empty($value['alias_cny'])) { ?><?= $value['alias_cny'] ?><? } else { ?><?= $value['name_cny'] ?><? } ?>"
                                        >
                                    <? if (!empty($value['alias'])) { ?><?= $value['alias'] ?><? } else { ?><?= $value['name'] ?><? } ?>
                                </option>
                            <? } ?>
                        </select>
                    <? } ?>
                </td>
            </tr>
        <? }} ?>

        <tr class="item-status" <? if (General::getConfigValue('hide_item_info_status')) { ?> style="display: none;"<? } ?>>
            <td class="w100"><?=Lang::get('status')?>:</td>
            <td><b><?=Lang::get('status'.$iteminfo['StuffStatus'])?></b></td>
        </tr>
        <tr class="item-all-quantity" <? if (General::getConfigValue('hide_item_info_in_existence')) { ?> style="display: none;"<? } ?>>
            <td class="w100"><?=Lang::get('in_existence')?>:</td>
            <td><b id="c_count"><?= $iteminfo['masterquantity'] ?> <?=Lang::get('pcs')?></b></td>
        </tr>
        <? if (isset($iteminfo['ActualWeightInfo']['Weight'])) { ?>
            <tr class="item-weight" <? if (General::getConfigValue('hide_item_info_weight')) { ?> style="display: none;"<? } ?>>
                <td class="w100"><?=$iteminfo['ActualWeightInfo']['DisplayName']?>:</td>
                <td><?=$iteminfo['ActualWeightInfo']['Weight']?> <?=Lang::get('kg')?></td>
            </tr>
        <? } ?>
        <? if($iteminfo['FeaturedValues']['SalesInLast30Days']){ ?>
        <tr class="item-sales-volume" <? if (General::getConfigValue('hide_item_info_sales_last30day')) { ?> style="display: none;"<? } ?>>
            <td class="w100"><?=Lang::get('sales_volume1')?>:</td>
            <td><?=$iteminfo['FeaturedValues']['SalesInLast30Days']?></td>
        </tr>
        <? } ?>
        <? if($iteminfo['FeaturedValues']['TotalSales']){ ?>
        <tr class="item-sales-volume" <? if (General::getConfigValue('hide_item_info_sales_last30day')) { ?> style="display: none;"<? } ?>>
            <td class="w100"><?=Lang::get('sales_volume')?>:</td>
            <td><?=$iteminfo['FeaturedValues']['TotalSales']?></td>
        </tr>
        <? } ?>
        <? if($iteminfo['FeaturedValues']['ItemReviewRating']){ ?>
        <tr>
            <td class="w100"><?=Lang::get('rating')?>:</td>
            <td><span class="ratyScore ratyScore-sm" data-score="<?=$iteminfo['FeaturedValues']['ItemReviewRating']?>"></span></td>
        </tr>
        <? } ?>

        <? if (! empty($quantityRanges)) { ?>
            <tr>
                <td colspan="2" style="padding-left: 0;">
                    <table class="table table-bordered table-condensed quantity-ranges" title="<?=Lang::get('Prices_ranges')?>">
                        <tr>
                            <? foreach ($quantityRanges as $rangeKey => $range) { ?>
                                <th><?=$range['DisplayRange']?></th>
                            <? } ?>
                        </tr>
                        <tr>
                            <? foreach ($quantityRanges as $rangeKey => $range) { ?>
                                <td data-range="<?=$range['MinRange'] ?: ''?>">
                                    <img src="/i/ajax-loader-transparent.gif" />
                                </td>
                            <? } ?>
                        </tr>
                    </table>
                </td>
            </tr>
        <? } ?>
        <? if (isset($iteminfo['Price']['PriceWithoutDiscountAndDelivery'])) { ?>
            <tr class="item-price-one-item" <? if (General::getConfigValue('hide_item_info_price1')) { ?> style="display: none;"<? } ?>>
                <td class="w100">
                    <?= Lang::get('price') ?> :
                </td>
                <td>
                    <b id="c_cost_one_item" class="ltr-for-rtl"></b> <b id="c_promo_cost_one_item"></b>
                </td>
            </tr>
        <? } ?>

        <tr class="item-price" <? if (General::getConfigValue('hide_item_info_price1')) { ?> style="display: none;"<? } ?>>
            <td class="w100">
                <?
                if (isset($iteminfo['Price']['PriceWithoutDiscountAndDelivery'])) {
                    $title = Lang::get('your_price');
                    $suffix = '<br/>' . Lang::get('group_price', array('group' => $discountGroup)) . '&nbsp;';
                } else {
                    $title = Lang::get('price');
                    $suffix = '';
                }
                ?>
                <?=$title?>&nbsp;<?=$suffix?>:
            </td>
            <td><b id="c_cost" class="ltr-for-rtl"></b> <b id="c_promo_cost"></b></td>
        </tr>
        <? if(isset($iteminfo['HasInternalDelivery']) && $iteminfo['HasInternalDelivery'] == 'true') { ?>
        <tr class="item-local-delivery" id="local_delivery"<? if (General::getConfigValue('hide_item_info_price_local_delivery')) { ?> style="display: none;"<? } ?>>
            <td class="td1"><?=Lang::get('local_delivery')?>:</td>
            <td class="td2" id="local_delivery_prices">
            </td>
        </tr>
        <? } ?>

        <tr class="item-quantity-edit" >
            <td class="w100"><?=Lang::get('quantity')?>:</td>
            <td>
                <!-- <input type="hidden" name="configurationId" id="confid" value=""/>
                <input type="hidden" name="itemConfiguration" id="confitem" value=""/> -->
                <b><input type="text" value="<?= $iteminfo['FirstLotQuantity'] ?>" class="w40 tar quantity input_numeric_only" name="quantity" id="quantity" max="<?= $iteminfo['masterquantity'] ?>" price="<?= $iteminfo['ConvertedPriceWithoutSign'] ?>" /></b>
                <span class="num-controls">
                    <span class="plus">+</span>
                    <span class="minus">-</span>
                </span>
            </td>
        </tr>

        <tr style="display: none">
            <td class="td1"><?=Lang::get('minimal_lot')?>:</span></td>
            <td class="td2"><span class="js-min-party"></span></td>
        </tr>

        <? if($iteminfo['configurations']){ ?>
            <tr>
                <td class="td1"><?=Lang::get('selected_conf')?>:</td>
                <td class="td2" id="c_cur">...</td>
            </tr>
        <? } ?>

        <?=    Plugins::invokeEvent('ShowGeoLocateAtItemInfo',array('LocalVal'=>@$_SESSION['CountryISO'])) ?>

        <tr class="total">
            <td><?=Lang::get('total')?>:</td>
            <td style="vertical-align: middle;"><span style="display: block" class="dl mr15 ltr-for-rtl" id="total"><img src="i/ajax-loader-transparent.gif" /></span></td>
        </tr>
        <tr class="addcart">
            <td colspan="2">
                <?
                $lexicons = array('translation_loading',
                    'add_to_cart','drop_from_cart',
                    'pcs','responses_loading',
                    'item_not_exist','good_added_to_cart',
                    'delete_from_cart','good_not_added',
                    'good_deleted_from_basket','add_to_cart',
                    'product_not_removed'
                );
                foreach($lexicons as $l){
                    ?>
                    <div id="<?=$l?>" style="display: none"><?=Lang::get($l)?></div>
                    <?
                }
                ?>

                <? if($iteminfo['IsSellAllowed'] == 'true') { ?>

                    <? if (!General::getConfigValue('is_old_platform')) { ?>
                        <button class="button button-big" id="quickOrder" title="<?=Lang::get('quick_order')?>" <?=User::getObject()->isAuthenticated() ? 'data-action="' . UrlGenerator::getUrl('order/quick-order') . '"' : 'data-redirect-url="' . UrlGenerator::generateContentUrl('login') . '"'?>>
                            <i class="icon-bolt"> <?=Lang::get('quick_order')?></i>
                        </button>
                    <? } ?>

                    <form action="/" id="addToBasket">
                        <a href="javascript:;" class="button button-big addbasket icon remove-action remove_from_basket" id="basket-action" title="<?=Lang::get('drop_from_cart')?>" alt="<?=Lang::get('drop_from_cart')?>"><span><i class="i rounder item-remove"></i><?=Lang::get('drop_from_cart')?></span></a>
                        <a href="javascript:;" class="button button-big addbasket icon add-action add_to_basket" style="display: none" id="basket-action" title="<?=Lang::get('add_to_cart')?>" alt="<?=Lang::get('add_to_cart')?>"><span><i class="i rounder item-add"></i><?=Lang::get('add_to_cart')?></span></a>

                        <input type="hidden" name="price" value="<?=$iteminfo['convertedpricewithoutsign']?>" />
                        <input type="hidden" name="currencyName" value="<?=$iteminfo['currencyname']?>" />
                        <input type="hidden" name="id" value="<?=$iteminfo['id']?>" />
                        <input type="hidden" name="weight" value="<?=@(float)$iteminfo['ActualWeightInfo']['Weight']?>" />
                        <input type="hidden" name="comment" value="" />
                    </form>

                    <p class="mt15 clrfix">

                        <a class="btn-small btn-remove fll remove_from_note" id="note-action" href="#"><span><?=Lang::get('drop_from_fav')?></span></a>
                        <a class="btn-small btn-add fll add_to_note" id="note-action" href="#"><span><?=Lang::get('add_to_fav')?></span></a>

                        <form action="/" id="addToFavourites">
                            <input type="hidden" name="price" value="<?=$iteminfo['convertedpricewithoutsign']?>" />
                            <input type="hidden" name="currencyName" value="<?=$iteminfo['currencyname']?>" />
                            <input type="hidden" name="id" value="<?=$iteminfo['id']?>" />
                            <input type="hidden" name="comment" value="" />
                        </form>
                    </p>

                <? } else { ?>
                    <h3><?=Lang::get('item_not_allowed')?></h3>
                    <h3><?=Lang::get($iteminfo['SellDisallowReason'])?></h3>
                <? } ?>
            </td>
        </tr>
    </table>
</div>
</div>
</div>

<div class="flr col240 iteminfo">
    <? if(!empty($vendorInfo) && $vendorInfo['name']){ ?>
    <div class="bproduct mb15">
        <h2 class="mb25"><span><?=Lang::get('about_vendor')?></span></h2>
        <div class="bgr-block">
            <table class="info f11">
                <? if(!General::getConfigValue('hide_vendor_info_name')) { ?>
                <tr>
                    <td><?=Lang::get('name')?>:</td>
                    <td><b><?= $this->escape($iteminfo['vendorname']) ?></b></td>
                </tr>
                <? }
                if ($vendorInfo['shopname']) { ?>
                    <tr>
                        <td><?=Lang::get('vendor_shop_name')?>:</td>
                        <td><b><?= $this->escape($vendorInfo['shopname']) ?></b></td>
                    </tr>
                <? }
                 if(!empty($vendorInfo['location']['city']) || !empty($vendorInfo['location']['state'])) { ?>
                <tr>
                    <td><?=Lang::get('placed_in')?>:</td>
                    <td><b>
                        <?=! empty($vendorInfo['location']['city']) ? $vendorInfo['location']['city'] : '' ?>
                        <?= (!empty($vendorInfo['location']['city']) && !empty($vendorInfo['location']['state'])) ? ',' : '' ?>
                        <?=! empty($vendorInfo['location']['state']) ? $vendorInfo['location']['state'] : '' ?>
                    </b></td>
                </tr>
                <? }
                if(! empty($vendorInfo['credit']['TotalFeedbacks'])) { ?>
                <tr>
                    <td><?=Lang::get('responses')?>:</td>
                    <td><b><?= $vendorInfo['credit']['TotalFeedbacks'] ?></b></td>
                </tr>
                <? }
                if(! empty($vendorInfo['credit']['PositiveFeedbacks'])) { ?>
                <tr>
                    <td><?=Lang::get('positive')?>:</td>
                    <td>
                        <b>
                            <?
                            $positive = $vendorInfo['credit']['PositiveFeedbacks'];
                            $total = $vendorInfo['credit']['TotalFeedbacks'];

                            $positivePersent = $positive>0 ? number_format(($positive/$total)*100, 2, '.', '') : 0;
                            ?>
                            <?=$positivePersent?>%
                        </b>
                    </td>
                </tr>
                <? }
                if($vendorInfo['scores']['DeliveryScore']) { ?>
                <tr>
                    <td><?=Lang::get('delivery_score')?>:</td>
                    <td>
                        <b>
                            <?=$vendorInfo['scores']['DeliveryScore']?>
                        </b>
                    </td>
                </tr>
                <? }
                if($vendorInfo['scores']['ItemScore']) { ?>
                <tr>
                    <td><?=Lang::get('item_score')?>:</td>
                    <td>
                        <b>
                            <?=$vendorInfo['scores']['ItemScore']?>
                        </b>
                    </td>
                </tr>
                <? }
                if($vendorInfo['Scores']['ServiceScore']) { ?>
                <tr>
                    <td><?=Lang::get('service_score')?>:</td>
                    <td>
                        <b>
                            <?=$vendorInfo['scores']['ServiceScore']?>
                        </b>
                    </td>
                </tr>
                <? } ?>
                <? if (!InstanceProvider::getObject()->isLimitItemsByCatalog()) { ?>
                <tr>
                    <td colspan="2" style="text-align: right">
                        <a href="#" id="add-vendor-to-favourites" style="<?= $vendorInfo['favoriteItemId'] ? 'display:none;' : ''?>" vendorid="<?= $this->escape($iteminfo['vendorid']) ?>" class="btn-small btn-add fll">
                            <span><?=Lang::get('add_vendor_to_favourites')?></span>
                        </a>
                        <a href="#" id="vendor-added-to-favourites" style="<?= $vendorInfo['favoriteItemId'] ? '' : 'display:none;'?>" vendorid="<?= $this->escape($iteminfo['vendorid']) ?>" class="btn-small btn-add fll btn-remove btn-delete-item " itemid="<?=$vendorInfo['favoriteItemId']?>">
                            <span><?=Lang::get('drop_vendor_from_fav')?></span>
                        </a>
                        <!--span class="fll" id="vendor-added-to-favourites" style="display:none;"><span><?=Lang::get('drop_from_fav')?></span-->
                    </td>
                </tr>
                <? } ?>
                <? if ($vendorInfo['credit']['level']) { ?>
                <tr>
                    <td><?=Lang::get('rating')?>:</td>
                    <td>
                        <? if (!General::getConfigValue('vendor_rating_view_as_number')) { ?>
                            <span class="raiting">
                                <i class="i-raiting raiting_<?= $vendorInfo['credit']['level'] ?>"></i>
                            </span>
                        <? } else { ?>
                            <span class="raiting">
                                <span class="rating_number raiting_<?=$vendorInfo['credit']['level']?>">
                                    <?=$vendorInfo['credit']['level']?>
                                </span>
                            </span>
                        <? } ?>
                        <? if(isset(General::$showVendorSalesVolume) && General::$showVendorSalesVolume){ ?>
                        <span class="info-product__col-sell">
                            <?=@Lang::get('vendor_rating_'.$vendorInfo['credit']['level'])?>
                        </span>
                        <? } ?>
                    </td>
                </tr>
                <? } ?>
                <? if (isset($vendorInfo['FeaturedValues'])) { ?>
                    <? if (isset($vendorInfo['FeaturedValues']['ItemReviewRating'])) { ?>
                        <tr>
                            <td><?=Lang::get('ItemReviewRating')?>:</td>
                            <td>
                                <b>
                                    <?=$vendorInfo['FeaturedValues']['ItemReviewRating']?>
                                </b>
                            </td>
                        </tr>
                    <? } ?>
                <? } ?>
            </table>
        </div>
    </div>
    <? } ?>

    <? if(in_array('Seo2', General::$enabledFeatures)){
            $url = 'item?';
            $urlv = 'vendor?';
        } else {
            $url = '/?p=item&';
            $urlv = '/?p=vendor&';
        }
    ?>
    <? if (!InstanceProvider::getObject()->isLimitItemsByCatalog()) { ?>
    <div class="bproduct">
        <? if (!empty($vendorItems)) { ?>
            <h2 class="mb25"><span><?=Lang::get('other_goods')?></span></h2>
            <ul class="lproduct flin w240 w70li clrfix">
                <? foreach ($vendorItems as $item) { ?>
                <li class="pic">
                    <a <?=$item['IsSellAllowed'] != 'false' ? 'href="' . $url . 'id=' . $item['id'] . '"' : ''?>>
                        <i><img width="70" height="70" src="<?=ProductsHelper::getSmallImage($item)?>" alt=""></i>
                        <ins class="<?=$item['IsSellAllowed'] == 'false' ? 'other_goods_disabled' : ''?>"></ins>
                    </a>
                </li>
                <? } ?>
            </ul>
        <? } ?>
        <? if ($vendorInfo['showLinkAllGoods']) { ?>
            <? if (! (InstanceProvider::getObject()->isLimitItemsByCatalog() && $cid == '')) { ?>
                <? $categoryId = (InstanceProvider::getObject()->isLimitItemsByCatalog()) ? $cid : ''; ?>
                <p class="mt5">
                    <a href="<?=UrlGenerator::generateSearchUrlByParams(['vid' => $iteminfo['vendorid']])?>" class="f11">
                        <?=Lang::get('all_goods_from_seller')?>
                    </a>
                </p>
            <? } ?>
        <? } ?>
    </div>
    <? } ?>
</div>

</div></div>

<div class="btabs mt15"><div class="wrap clrfix">
    <div class="bgr clrfix">
        <ul id="product-tabs" class="tabs clrfix">
            <?php if (empty($isWarehouseProduct)) { ?>
            <li tab="properties" class="active">
                <a href="#"><span><?=Lang::get('prod_char')?></span><i></i></a>
            </li>
            <?php } ?>
            <li tab="photos" class="">
                <a href="#" attr="tab2"><span><?=Lang::get('photo_descr')?></span><i></i></a>
            </li>
            <? if(!General::getConfigValue('hide_item_site_responses')){ ?>
            <? AssetsMin::registerJsFile('js/pages/itemreviews.js') ?>
            <li tab="paymship" item_id="<?= $iteminfo["id"] ?>"  class="">

                <a href="#" attr="tab3" data-review-id="<?=RequestWrapper::getValueSafe('reviewId')?>"><span><?=Lang::get('user_responses')?></span><i></i></a>

            </li>
            <? } ?>
            <? if (! General::getConfigValue('hide_taobao_responses') && empty($isWarehouseProduct) && $hasItemReviews) { ?>
            <li tab="TAOBAOcomments" item_id="<?= $iteminfo["id"] ?>"  class="">

                <a href="#" attr="tab4"><span><?=Lang::get('External_comments')?></span><i></i></a>

            </li>
            <? } ?>
        </ul>
    </div>
    <div class="tabs-content">
        <?php if (empty($isWarehouseProduct)) { ?>
        <!-- properties -->
        <div id="properties" class="tab" style="display: block;">
            <table class="itcharac">
                <tbody>
                <? if (is_array($iteminfo['propertiesEdited'])) {
                    foreach ($iteminfo['propertiesEdited'] as $property) {
                    ?>
                    <tr>
                        <td class="td1"><?= $property['name'] ?>:</td>
                        <td class="td2"><?= $property['value']?>

                        </td>
                    </tr>

                    <? } ?>
                <? } ?>
                </tbody>
            </table>
        </div>
        <!-- /properties -->
        <?php } ?>
        <!-- photos -->
        <div id="photos" class="tab">
            <?php if (empty($isWarehouseProduct)) { ?>
                <a href="#" class="button button-big" onclick="tr_desc(this);return false;"><span class="other"><?=Lang::get('original_descr')?></span></a>
                <br />
                <br />
            <?php } ?>
            <div id="photos-inner"></div>
        </div>
        <!-- /photos -->
        <div id="paymship" item_id="<?= $iteminfo["id"] ?>" data-item-id="<?= $iteminfo["id"] ?>" class="tab js-reviews-container js-reviews-tab"></div>
        <? if (! General::getConfigValue('hide_taobao_responses') && empty($isWarehouseProduct)) { ?>
        <div id="TAOBAOcomments" item_id="<?= $iteminfo["id"] ?>" class="tab"></div>
        <? } ?>
        <div id="addinfo" class="tab"></div>
    </div>
</div></div>

<div class="wrap clrfix">
    <?
    if (! General::getConfigValue('show_user_history_views')) {
        if (Session::isAuthenticated()) {
            // Выводим просмотренные
            Plugins::invokeEvent('ShowHistory');
            // Вставлем в просмотренные
            Plugins::invokeEvent('AddItemHistory',array('nme'=>$iteminfo['title'],'id'=>$iteminfo['id'],'price'=>General::getCurrencyPrice($iteminfo),'pic'=>$iteminfo['mainpictureurl'],'promo_price'=>General::getCurrencyPromoPrice($iteminfo)));
        }
    }
    ?>
</div>

<div id="order-overlay"></div>
<?=Lang::loadJSTranslation(array('make_order', 'continue_shopping'))?>
<!--noindex-->
<script type="text/javascript">
    var preLoadDescription = <?=General::getConfigValue('product_tabs') == 2 ? 'true' : 'false'?>;
    var itempath = <?=json_encode($GLOBALS['itempath'])?>;

    <? if(defined('CFG_LOAD_ITEM_VIA_AJAX') && CFG_LOAD_ITEM_VIA_AJAX){ ?>
    $.each(itempath, function(k, v){
        var virt = '';
        if(v.IsVirtual[0] == 'true'){
            virt = '&virt';
        }
        $('.crumbs .wrap').append(
            $('<a></a>')
                .attr({
                    href: '/?p=subcategory&cid='+ v.id + virt
                })
                .text(v.Name)
        );
    });
        <? } ?>


    iteminfo = {
        id: '<?= $iteminfo['id'] ?>',
        providerType: '<?= $iteminfo['ProviderType'] ?>',
        debug: '<?=isset($_GET['debug'])?>',
        confid: 0,
        confitem: '',
        weight: '<?=@(float)$iteminfo['ActualWeightInfo']['Weight']?>',
        //isvalidpromotions: '<?= $iteminfo['IsValidPromotions'] ?>',
        promoid: '<?=$iteminfo["Promotions"]["Id"]?>',
        count: <?= $iteminfo['FirstLotQuantity'] ?>,
        maxcount: '<?= $iteminfo['masterquantity'] ?>',
        minCount: <?= $iteminfo['FirstLotQuantity'] ?>,
        stepCount: <?= $iteminfo['NextLotQuantity'] ?>,
        //addedToCartId: <?=$inCart?>,
        //addedToNoteId: <?=$inNote?>,
        addedToCartId: 0,
        addedToNoteId: 0,

        addedToCart: <?=json_encode($inCart)?>,
        addedToNote: <?=json_encode($inNote)?>,

        price_without_config: <?=json_encode($iteminfo["Price"])?>,
        promotions: <?=json_encode($iteminfo["Promotions"])?>,
        promo: <?=json_encode($promo)?>,
        promo_static: <?=json_encode($promo)?>,
        price: <?=json_encode($iteminfo["Price"])?>,
        quantityranges: <?=json_encode($iteminfo["QuantityRanges"])?>,
        item_with_config: <?=json_encode($iteminfo["item_with_config"])?>,
        configurations: <?=count($iteminfo['configurations']) ? json_encode($iteminfo['configurations']) : 0?>,
        CFG_NO_DELIVERY_IN_PRICE: '<?=(int)(defined('CFG_NO_DELIVERY_IN_PRICE')&&CFG_NO_DELIVERY_IN_PRICE)?>',
        CFG_ROUND_DECIMALS: <?=(int)General::getConfigValue('price_rounding')?>
    };

    langs = {
        good_added_to_fav: '<?=Lang::get('good_added_to_fav')?>!',
        delete_from_fav: '<?=Lang::get('delete_from_fav')?>',
        good_not_added: '<?=Lang::get('good_not_added')?>',
        good_removed_from_fav: '<?=Lang::get('good_removed_from_fav')?>!',
        add_to_fav: '<?=Lang::get('add_to_fav')?>',
        product_not_removed: '<?=Lang::get('product_not_removed')?>',
        pcs: '<?=Lang::get('pcs')?>',
        vendor_added_to_favourites: '<?=Lang::get('vendor_added_to_favourites')?>',
        warning: '<?=Lang::get('warning')?>',
        sell_not_allowed_without_config: '<?=Lang::get('sell_not_allowed_without_config')?>',
        vendor_removed_from_favourites: '<?=Lang::get('vendor_removed_from_favourites')?>',
        choosen_max_item_count: '<?=Lang::get('choosen_max_item_count')?>',
        min_count: '<?=Lang::get('min_count_alert')?>',
        step_count: '<?=Lang::get('step_count_alert')?>',
        additional_value: '<?=Lang::get('additional_value')?>',
        supplement_for_heading: '<?=Lang::get('supplement_for_heading')?>',
        delivery: '<?=Lang::get('delivery')?>',
        select_later: '<?=Lang::get('select_later')?>',
        reg_order: '<?=Lang::get('reg_order')?>',
        minimal_lot: '<?=Lang::get('minimal_lot')?>'
    };


    $(function(){
        <? if(!General::getConfigValue('hide_item_site_responses')){ ?>
        $('[attr="tab3"]').click(function(){
            self = $(this);
            $('#paymship').html('<div class="spinner"></div>');
            $.get("//"+window.location.hostname,{
                p: 'itemcomments',
                itemid: "<?=RequestWrapper::getValueSafe('id')?>",
                reviewId: self.data('review-id')
            }, function(data){
                if (data.errorCode === 'SessionExpired') {
                    window.location.replace('/?p=login');
                }
                $('#paymship').html(data.reviews);
            });
            return false;
        });
        <? } ?>
        <? if (! General::getConfigValue('hide_taobao_responses') && empty($isWarehouseProduct)) { ?>
        $('[attr="tab4"]').click(function(){
            if ($('#TAOBAOcomments').html()) return;
            $('#TAOBAOcomments').html('<div class="spinner"></div>');
            $.ajax({
                url: '/?p=itemtraderateinfo&itemid=' + $('#TAOBAOcomments').attr('item_id'),
                success: function(data) {
                    $('#TAOBAOcomments').html(data);
                }
            });
            return false;
        });
        <? } ?>
        if (iteminfo.minCount > 1){
            $('span.js-min-party').html(iteminfo.minCount).closest('tr').show();
        }
    });
    defaultCurrencySign = "<?=$defaultCurrencySign?>";
    defaultDeliveryMode = "<?=$defaultDeliveryMode?>";
    var photosInnerContent = <?=json_encode(htmlentities($iteminfo['Description'], ENT_QUOTES))?>;
    defaultCurrencySign = '<?=User::getObject()->getCurrencySign()?>';
</script>
<script type="text/javascript" src="js/item.js?<?=CFG_SITE_VERSION;?>"></script>

<script type="text/javascript">
$(function(){
    photosInnerContent = $('<div/>').html(photosInnerContent).text();
    $('#photos-inner').html(photosInnerContent);

    $('span.ratyScore').raty({
        readOnly: true
    });

    $(".pictures").colorbox({rel:'group1', photo:true});

    <? if (empty($iteminfo['propertiesEdited'])) { ?>
        $('#product-tabs li[tab="properties"]').hide();
    <? } ?>

    <? if ($isWarehouseProduct || empty($iteminfo['propertiesEdited'])) { ?>
        $('#product-tabs li[tab="photos"] a').click();
    <? } ?>

    <? if (General::getConfigValue('product_tabs')) {
        switch (General::getConfigValue('product_tabs')) {
            case '2': ?>
                $('#product-tabs li[tab="photos"] a').click();
                <? break;
            case '3': ?>
                $('#product-tabs li[tab="paymship"] a').click();
                <? break;
            case '4': ?>
                $('#product-tabs li[tab="TAOBAOcomments"] a').click();
                <? break;
        }
    } ?>

    <? if ($showReviewTab !== false) { ?>
        var reviewTab = $('#product-tabs li[tab="paymship"] a');
        reviewTab.click();
        $("body,html").animate({"scrollTop":reviewTab.offset().top}, 1000);
    <? } ?>

    //наведение мышкой на i
    $('body').tooltip({
        selector: '[rel="tooltip"]',
        trigger: 'hover'
    });
});
</script>

<!--/noindex-->

<?=Plugins::invokeEvent('onRenderItemPage', array('id' => RequestWrapper::getValueSafe('id')))?>
<?=Plugins::invokeEvent('onItemInfoStatistics', array('itemInfo' => $iteminfo, 'category' => @end($GLOBALS['itempath'])))?>

<div id="item-debug"></div>

<link rel="stylesheet" href="css/vendor/jquery.raty.css?<?=CFG_SITE_VERSION;?>"/>
<script type="text/javascript" src="js/vendor/jquery.raty.js?<?=CFG_SITE_VERSION;?>"></script>
